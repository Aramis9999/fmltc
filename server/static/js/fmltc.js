/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,a-b.length)+b}},"es8","es3");$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,f=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<f&&c<e;)if(b[c++]!=a[g++])return!1;return g>=f}},"es6","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var COMPILED=!0,goog=goog||{};goog.global=this||self;
goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||"undefined"==typeof c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c=c[d]&&c[d]!==Object.prototype[d]?c[d]:c[d]={}:c[d]=b};
goog.define=function(a,b){if(!COMPILED){var c=goog.global.CLOSURE_UNCOMPILED_DEFINES,d=goog.global.CLOSURE_DEFINES;c&&void 0===c.nodeType&&Object.prototype.hasOwnProperty.call(c,a)?b=c[a]:d&&void 0===d.nodeType&&Object.prototype.hasOwnProperty.call(d,a)&&(b=d[a])}return b};goog.FEATURESET_YEAR=2012;goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;
goog.provide=function(a){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)};
goog.getScriptNonce=function(a){if(a&&a!=goog.global)return goog.getScriptNonce_(a.document);null===goog.cspNonce_&&(goog.cspNonce_=goog.getScriptNonce_(goog.global.document));return goog.cspNonce_};goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/;goog.cspNonce_=null;goog.getScriptNonce_=function(a){return(a=a.querySelector&&a.querySelector("script[nonce]"))&&(a=a.nonce||a.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(a)?a:""};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(a){if("string"!==typeof a||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");
if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};
goog.module.getInternal_=function(a){if(!COMPILED){if(a in goog.loadedModules_)return goog.loadedModules_[a].exports;if(!goog.implicitNamespaces_[a])return a=goog.getObjectByName(a),null!=a?a:null}return null};goog.ModuleType={ES6:"es6",GOOG:"goog"};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()};goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG};
goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var a=goog.global.$jscomp;return a?"function"!=typeof a.getCurrentModulePath?!1:!!a.getCurrentModulePath():!1};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.declareModuleId=function(a){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw Error("goog.declareModuleId may only be called from within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw Error("goog.declareModuleId may only be called once per module.");if(a in goog.loadedModules_)throw Error('Module with namespace "'+a+'" already exists.');}if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=a;else{var b=goog.global.$jscomp;if(!b||"function"!=typeof b.getCurrentModulePath)throw Error('Module with namespace "'+
a+'" has been loaded incorrectly.');b=b.require(b.getCurrentModulePath());goog.loadedModules_[a]={exports:b,type:goog.ModuleType.ES6,moduleId:a}}};goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&null!=goog.getObjectByName(a)},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(a,b){a=a.split(".");b=b||goog.global;for(var c=0;c<a.length;c++)if(b=b[a[c]],null==b)return null;return b};goog.globalize=function(a,b){b=b||goog.global;for(var c in a)b[c]=a[c]};goog.addDependency=function(a,b,c,d){!COMPILED&&goog.DEPENDENCIES_ENABLED&&goog.debugLoader_.addDependency(a,b,c,d)};goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};
goog.require=function(a){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.debugLoader_.requested(a);if(goog.isProvided_(a)){if(goog.isInModuleLoader_())return goog.module.getInternal_(a)}else if(goog.ENABLE_DEBUG_LOADER){var b=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(a)}finally{goog.moduleLoaderState_=b}}return null}};goog.requireType=function(a){return{}};goog.basePath="";goog.nullFunction=function(){};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.instance_=void 0;a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE="detect";
goog.ASSUME_ES_MODULES_TRANSPILED=!1;goog.TRANSPILE_TO_LANGUAGE="";goog.TRANSPILER="transpile.js";goog.hasBadLetScoping=null;goog.useSafari10Workaround=function(){if(null==goog.hasBadLetScoping){try{var a=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(b){a=!1}goog.hasBadLetScoping=a}return goog.hasBadLetScoping};goog.workaroundSafari10EvalBug=function(a){return"(function(){"+a+"\n;})();\n"};
goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG};if(goog.isFunction(a))var c=a.call(void 0,{});else if("string"===typeof a)goog.useSafari10Workaround()&&(a=goog.workaroundSafari10EvalBug(a)),c=goog.loadModuleFromSource_.call(void 0,a);else throw Error("Invalid module definition");var d=goog.moduleLoaderState_.moduleName;if("string"===typeof d&&d)goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(d,
c):goog.SEAL_MODULE_EXPORTS&&Object.seal&&"object"==typeof c&&null!=c&&Object.seal(c),goog.loadedModules_[d]={exports:c,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName};else throw Error('Invalid module name "'+d+'"');}finally{goog.moduleLoaderState_=b}};goog.loadModuleFromSource_=function(a){eval(a);return{}};goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")};
goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);try{var b=new goog.global.XMLHttpRequest;b.open("get",a,!1);b.send();return 0==b.status||200==b.status?b.responseText:null}catch(c){return null}};
goog.transpile_=function(a,b,c){var d=goog.global.$jscomp;d||(goog.global.$jscomp=d={});var e=d.transpile;if(!e){var f=goog.basePath+goog.TRANSPILER,g=goog.loadFileSync_(f);if(g){(function(){(0,eval)(g+"\n//# sourceURL="+f)}).call(goog.global);if(goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=
goog.global.$gwtExport.$jscomp.transpile;d=goog.global.$jscomp;e=d.transpile}}e||(e=d.transpile=function(a,b){goog.logToConsole_(b+" requires transpilation but no transpiler was found.");return a});return e(a,b,c)};
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};
goog.getUid=function(a){return Object.prototype.hasOwnProperty.call(a,goog.UID_PROPERTY_)&&a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){null!==a&&"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;
goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if("function"===typeof a.clone)return a.clone();b="array"==b?[]:{};for(var c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_){try{goog.global.eval("var _evalTest_ = 1;")}catch(d){}if("undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(d){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1}if(goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.defer=
!1;c.appendChild(b.createTextNode(a));b.head.appendChild(c);b.head.removeChild(c)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;
goog.getCssName=function(a,b){if("."==String(a).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+a);var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")};d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};a=b?a+"-"+d(b):d(a);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(a):a};
goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b,c){c&&c.html&&(a=a.replace(/</g,"&lt;"));b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,c){return null!=b&&c in b?b[c]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};
goog.exportProperty=function(a,b,c){a[b]=c};goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};goog.scope=function(a){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(a,b){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return a;var c=!goog.defineClass.isUnsealable_(b),d=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===d&&c&&Object.seal instanceof Function&&Object.seal(b);return b};return d};goog.defineClass.isUnsealable_=function(a){return a&&a.prototype&&a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";
!COMPILED&&goog.DEPENDENCIES_ENABLED&&(goog.inHtmlDocument_=function(){var a=goog.global.document;return null!=a&&"write"in a},goog.isDocumentLoading_=function(){var a=goog.global.document;return a.attachEvent?"complete"!=a.readyState:"loading"==a.readyState},goog.findBasePath_=function(){if(void 0!=goog.global.CLOSURE_BASE_PATH&&"string"===typeof goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var a=goog.global.document,b=a.currentScript;
a=b?[b]:a.getElementsByTagName("SCRIPT");for(b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?");d=-1==d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}}},goog.findBasePath_(),goog.Transpiler=function(){this.requiresTranspilation_=null;this.transpilationTarget_=goog.TRANSPILE_TO_LANGUAGE},goog.Transpiler.prototype.createRequiresTranspilation_=function(){function a(a,b){e?d[a]=!0:b()?(c=a,d[a]=!1):e=d[a]=!0}function b(a){try{return!!eval(a)}catch(k){return!1}}
var c="es3",d={es3:!1},e=!1,f=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";a("es5",function(){return b("[1,].length==1")});a("es6",function(){return f.match(/Edge\/(\d+)(\.\d)*/i)?!1:b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')});
a("es7",function(){return b("2 ** 2 == 4")});a("es8",function(){return b("async () => 1, true")});a("es9",function(){return b("({...rest} = {}), true")});a("es_next",function(){return!1});return{target:c,map:d}},goog.Transpiler.prototype.needsTranspile=function(a,b){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;if(!this.requiresTranspilation_){var c=this.createRequiresTranspilation_();this.requiresTranspilation_=c.map;this.transpilationTarget_=this.transpilationTarget_||
c.target}if(a in this.requiresTranspilation_)return this.requiresTranspilation_[a]?!0:!goog.inHtmlDocument_()||"es6"!=b||"noModule"in goog.global.document.createElement("script")?!1:!0;throw Error("Unknown language mode: "+a);},goog.Transpiler.prototype.transpile=function(a,b){return goog.transpile_(a,b,this.transpilationTarget_)},goog.transpiler_=new goog.Transpiler,goog.protectScriptTag_=function(a){return a.replace(/<\/(SCRIPT)/ig,"\\x3c/$1")},goog.DebugLoader_=function(){this.dependencies_={};
this.idToPath_={};this.written_={};this.loadingDeps_=[];this.depsToLoad_=[];this.paused_=!1;this.factory_=new goog.DependencyFactory(goog.transpiler_);this.deferredCallbacks_={};this.deferredQueue_=[]},goog.DebugLoader_.prototype.bootstrap=function(a,b){function c(){d&&(goog.global.setTimeout(d,0),d=null)}var d=b;if(a.length){b=[];for(var e=0;e<a.length;e++){var f=this.getPathFromDeps_(a[e]);if(!f)throw Error("Unregonized namespace: "+a[e]);b.push(this.dependencies_[f])}f=goog.require;var g=0;for(e=
0;e<a.length;e++)f(a[e]),b[e].onLoad(function(){++g==a.length&&c()})}else c()},goog.DebugLoader_.prototype.loadClosureDeps=function(){this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+"deps.js"),"deps.js",[],[],{},!1));this.loadDeps_()},goog.DebugLoader_.prototype.requested=function(a,b){(a=this.getPathFromDeps_(a))&&(b||this.areDepsLoaded_(this.dependencies_[a].requires))&&(b=this.deferredCallbacks_[a])&&(delete this.deferredCallbacks_[a],b())},goog.DebugLoader_.prototype.setDependencyFactory=
function(a){this.factory_=a},goog.DebugLoader_.prototype.load_=function(a){if(this.getPathFromDeps_(a)){var b=this,c=[],d=function(a){var e=b.getPathFromDeps_(a);if(!e)throw Error("Bad dependency path or symbol: "+a);if(!b.written_[e]){b.written_[e]=!0;a=b.dependencies_[e];for(e=0;e<a.requires.length;e++)goog.isProvided_(a.requires[e])||d(a.requires[e]);c.push(a)}};d(a);a=!!this.depsToLoad_.length;this.depsToLoad_=this.depsToLoad_.concat(c);this.paused_||a||this.loadDeps_()}else throw a="goog.require could not find: "+
a,goog.logToConsole_(a),Error(a);},goog.DebugLoader_.prototype.loadDeps_=function(){for(var a=this,b=this.paused_;this.depsToLoad_.length&&!b;)(function(){var c=!1,d=a.depsToLoad_.shift(),e=!1;a.loading_(d);var f={pause:function(){if(c)throw Error("Cannot call pause after the call to load.");b=!0},resume:function(){c?a.resume_():b=!1},loaded:function(){if(e)throw Error("Double call to loaded.");e=!0;a.loaded_(d)},pending:function(){for(var b=[],c=0;c<a.loadingDeps_.length;c++)b.push(a.loadingDeps_[c]);
return b},setModuleState:function(a){goog.moduleLoaderState_={type:a,moduleName:"",declareLegacyNamespace:!1}},registerEs6ModuleExports:function(a,b,c){c&&(goog.loadedModules_[c]={exports:b,type:goog.ModuleType.ES6,moduleId:c||""})},registerGoogModuleExports:function(a,b){goog.loadedModules_[a]={exports:b,type:goog.ModuleType.GOOG,moduleId:a}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(b){if(c)throw Error("Cannot register with defer after the call to load.");a.defer_(d,
b)},areDepsLoaded:function(){return a.areDepsLoaded_(d.requires)}};try{d.load(f)}finally{c=!0}})();b&&this.pause_()},goog.DebugLoader_.prototype.pause_=function(){this.paused_=!0},goog.DebugLoader_.prototype.resume_=function(){this.paused_&&(this.paused_=!1,this.loadDeps_())},goog.DebugLoader_.prototype.loading_=function(a){this.loadingDeps_.push(a)},goog.DebugLoader_.prototype.loaded_=function(a){for(var b=0;b<this.loadingDeps_.length;b++)if(this.loadingDeps_[b]==a){this.loadingDeps_.splice(b,1);
break}for(b=0;b<this.deferredQueue_.length;b++)if(this.deferredQueue_[b]==a.path){this.deferredQueue_.splice(b,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)for(;this.deferredQueue_.length;)this.requested(this.deferredQueue_.shift(),!0);a.loaded()},goog.DebugLoader_.prototype.areDepsLoaded_=function(a){for(var b=0;b<a.length;b++){var c=this.getPathFromDeps_(a[b]);if(!c||!(c in this.deferredCallbacks_||goog.isProvided_(a[b])))return!1}return!0},goog.DebugLoader_.prototype.getPathFromDeps_=
function(a){return a in this.idToPath_?this.idToPath_[a]:a in this.dependencies_?a:null},goog.DebugLoader_.prototype.defer_=function(a,b){this.deferredCallbacks_[a.path]=b;this.deferredQueue_.push(a.path)},goog.LoadController=function(){},goog.LoadController.prototype.pause=function(){},goog.LoadController.prototype.resume=function(){},goog.LoadController.prototype.loaded=function(){},goog.LoadController.prototype.pending=function(){},goog.LoadController.prototype.registerEs6ModuleExports=function(a,
b,c){},goog.LoadController.prototype.setModuleState=function(a){},goog.LoadController.prototype.clearModuleState=function(){},goog.LoadController.prototype.defer=function(a){},goog.LoadController.prototype.areDepsLoaded=function(){},goog.Dependency=function(a,b,c,d,e){this.path=a;this.relativePath=b;this.provides=c;this.requires=d;this.loadFlags=e;this.loaded_=!1;this.loadCallbacks_=[]},goog.Dependency.prototype.getPathName=function(){var a=this.path,b=a.indexOf("://");0<=b&&(a=a.substring(b+3),b=
a.indexOf("/"),0<=b&&(a=a.substring(b+1)));return a},goog.Dependency.prototype.onLoad=function(a){this.loaded_?a():this.loadCallbacks_.push(a)},goog.Dependency.prototype.loaded=function(){this.loaded_=!0;var a=this.loadCallbacks_;this.loadCallbacks_=[];for(var b=0;b<a.length;b++)a[b]()},goog.Dependency.defer_=!1,goog.Dependency.callbackMap_={},goog.Dependency.registerCallback_=function(a){var b=Math.random().toString(32);goog.Dependency.callbackMap_[b]=a;return b},goog.Dependency.unregisterCallback_=
function(a){delete goog.Dependency.callbackMap_[a]},goog.Dependency.callback_=function(a,b){if(a in goog.Dependency.callbackMap_){for(var c=goog.Dependency.callbackMap_[a],d=[],e=1;e<arguments.length;e++)d.push(arguments[e]);c.apply(void 0,d)}else throw Error("Callback key "+a+" does not exist (was base.js loaded more than once?).");},goog.Dependency.prototype.load=function(a){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?a.loaded():a.pause();else if(goog.inHtmlDocument_()){var b=
goog.global.document;if("complete"==b.readyState&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){if(/\bdeps.js$/.test(this.path)){a.loaded();return}throw Error('Cannot write "'+this.path+'" after document load');}if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var c=goog.Dependency.registerCallback_(function(b){goog.DebugLoader_.IS_OLD_IE_&&"complete"!=b.readyState||(goog.Dependency.unregisterCallback_(c),a.loaded())}),d=!goog.DebugLoader_.IS_OLD_IE_&&goog.getScriptNonce()?
' nonce="'+goog.getScriptNonce()+'"':"";d='<script src="'+this.path+'" '+(goog.DebugLoader_.IS_OLD_IE_?"onreadystatechange":"onload")+"=\"goog.Dependency.callback_('"+c+'\', this)" type="text/javascript" '+(goog.Dependency.defer_?"defer":"")+d+">\x3c/script>";b.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(d):d)}else{var e=b.createElement("script");e.defer=goog.Dependency.defer_;e.async=!1;e.type="text/javascript";(d=goog.getScriptNonce())&&e.setAttribute("nonce",d);goog.DebugLoader_.IS_OLD_IE_?
(a.pause(),e.onreadystatechange=function(){if("loaded"==e.readyState||"complete"==e.readyState)a.loaded(),a.resume()}):e.onload=function(){e.onload=null;a.loaded()};e.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path;b.head.appendChild(e)}}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),"deps.js"==this.relativePath?(goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, or setting CLOSURE_NO_DEPS to true."),
a.loaded()):a.pause()},goog.Es6ModuleDependency=function(a,b,c,d,e){goog.Dependency.call(this,a,b,c,d,e)},goog.inherits(goog.Es6ModuleDependency,goog.Dependency),goog.Es6ModuleDependency.prototype.load=function(a){function b(a,b){a=b?'<script type="module" crossorigin>'+b+"\x3c/script>":'<script type="module" crossorigin src="'+a+'">\x3c/script>';d.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(a):a)}function c(a,b){var c=d.createElement("script");c.defer=!0;c.async=!1;c.type=
"module";c.setAttribute("crossorigin",!0);var e=goog.getScriptNonce();e&&c.setAttribute("nonce",e);b?c.textContent=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(b):b:c.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(a):a;d.head.appendChild(c)}if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?a.loaded():a.pause();else if(goog.inHtmlDocument_()){var d=goog.global.document,e=this;if(goog.isDocumentLoading_()){var f=b;goog.Dependency.defer_=
!0}else f=c;var g=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(g);a.setModuleState(goog.ModuleType.ES6)});f(void 0,'goog.Dependency.callback_("'+g+'")');f(this.path,void 0);var k=goog.Dependency.registerCallback_(function(b){goog.Dependency.unregisterCallback_(k);a.registerEs6ModuleExports(e.path,b,goog.moduleLoaderState_.moduleName)});f(void 0,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+k+'", m)');var h=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(h);
a.clearModuleState();a.loaded()});f(void 0,'goog.Dependency.callback_("'+h+'")')}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),a.pause()},goog.TransformedDependency=function(a,b,c,d,e){goog.Dependency.call(this,a,b,c,d,e);this.contents_=null;this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))},goog.inherits(goog.TransformedDependency,goog.Dependency),goog.TransformedDependency.prototype.load=function(a){function b(){e.contents_=
goog.loadFileSync_(e.path);e.contents_&&(e.contents_=e.transform(e.contents_),e.contents_&&(e.contents_+="\n//# sourceURL="+e.path))}function c(){e.lazyFetch_&&b();if(e.contents_){f&&a.setModuleState(goog.ModuleType.ES6);try{var c=e.contents_;e.contents_=null;goog.globalEval(c);if(f)var d=goog.moduleLoaderState_.moduleName}finally{f&&a.clearModuleState()}f&&goog.global.$jscomp.require.ensure([e.getPathName()],function(){a.registerEs6ModuleExports(e.path,goog.global.$jscomp.require(e.getPathName()),
d)});a.loaded()}}function d(){var a=goog.global.document,b=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(b);c()}),d='<script type="text/javascript">'+goog.protectScriptTag_('goog.Dependency.callback_("'+b+'");')+"\x3c/script>";a.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(d):d)}var e=this;if(goog.global.CLOSURE_IMPORT_SCRIPT)b(),this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)?(this.contents_=null,a.loaded()):a.pause();
else{var f=this.loadFlags.module==goog.ModuleType.ES6;this.lazyFetch_||b();var g=1<a.pending().length,k=g&&goog.DebugLoader_.IS_OLD_IE_;g=goog.Dependency.defer_&&(g||goog.isDocumentLoading_());if(k||g)a.defer(function(){c()});else{var h=goog.global.document;k=goog.inHtmlDocument_()&&"ActiveXObject"in goog.global;if(f&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!k){goog.Dependency.defer_=!0;a.pause();var m=h.onreadystatechange;h.onreadystatechange=function(){"interactive"==h.readyState&&(h.onreadystatechange=
m,c(),a.resume());goog.isFunction(m)&&m.apply(void 0,arguments)}}else!goog.DebugLoader_.IS_OLD_IE_&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()?d():c()}}},goog.TransformedDependency.prototype.transform=function(a){},goog.TranspiledDependency=function(a,b,c,d,e,f){goog.TransformedDependency.call(this,a,b,c,d,e);this.transpiler=f},goog.inherits(goog.TranspiledDependency,goog.TransformedDependency),goog.TranspiledDependency.prototype.transform=function(a){return this.transpiler.transpile(a,this.getPathName())},
goog.PreTranspiledEs6ModuleDependency=function(a,b,c,d,e){goog.TransformedDependency.call(this,a,b,c,d,e)},goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency),goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(a){return a},goog.GoogModuleDependency=function(a,b,c,d,e,f,g){goog.TransformedDependency.call(this,a,b,c,d,e);this.needsTranspile_=f;this.transpiler_=g},goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency),goog.GoogModuleDependency.prototype.transform=
function(a){this.needsTranspile_&&(a=this.transpiler_.transpile(a,this.getPathName()));return goog.LOAD_MODULE_USING_EVAL&&void 0!==goog.global.JSON?"goog.loadModule("+goog.global.JSON.stringify(a+"\n//# sourceURL="+this.path+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+a+"\n;return exports});\n//# sourceURL="+this.path+"\n"},goog.DebugLoader_.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.DebugLoader_.prototype.addDependency=function(a,b,c,
d){b=b||[];a=a.replace(/\\/g,"/");var e=goog.normalizePath_(goog.basePath+a);d&&"boolean"!==typeof d||(d=d?{module:goog.ModuleType.GOOG}:{});c=this.factory_.createDependency(e,a,b,c,d,goog.transpiler_.needsTranspile(d.lang||"es3",d.module));this.dependencies_[e]=c;for(c=0;c<b.length;c++)this.idToPath_[b[c]]=e;this.idToPath_[a]=e},goog.DependencyFactory=function(a){this.transpiler=a},goog.DependencyFactory.prototype.createDependency=function(a,b,c,d,e,f){return e.module==goog.ModuleType.GOOG?new goog.GoogModuleDependency(a,
b,c,d,e,f,this.transpiler):f?new goog.TranspiledDependency(a,b,c,d,e,this.transpiler):e.module==goog.ModuleType.ES6?"never"==goog.TRANSPILE&&goog.ASSUME_ES_MODULES_TRANSPILED?new goog.PreTranspiledEs6ModuleDependency(a,b,c,d,e):new goog.Es6ModuleDependency(a,b,c,d,e):new goog.Dependency(a,b,c,d,e)},goog.debugLoader_=new goog.DebugLoader_,goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()},goog.setDependencyFactory=function(a){goog.debugLoader_.setDependencyFactory(a)},goog.global.CLOSURE_NO_DEPS||
goog.debugLoader_.loadClosureDeps(),goog.bootstrap=function(a,b){goog.debugLoader_.bootstrap(a,b)});goog.TRUSTED_TYPES_POLICY_NAME="";goog.identity_=function(a){return a};goog.createTrustedTypesPolicy=function(a){var b=null,c=goog.global.trustedTypes||goog.global.TrustedTypes;if(!c||!c.createPolicy)return b;try{b=c.createPolicy(a,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_,createURL:goog.identity_})}catch(d){goog.logToConsole_(d.message)}return b};
goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null;/*

 Copyright 2020 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

    https://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var fmltc={Point:function(){this.y=this.x=0}};fmltc.Point.prototype.fromMouseEvent=function(a,b,c){this.x=a.pageX;for(this.y=a.pageY;b;)this.x-=b.offsetLeft,this.y-=b.offsetTop,b=b.offsetParent;this.x/=c;this.y/=c;this.x=Math.round(this.x);this.y=Math.round(this.y)};fmltc.Point.prototype.fromAnotherPoint=function(a){this.x=a.x;this.y=a.y};fmltc.Box=function(a,b,c,d,e){this.set(a,b,c,d,e)};fmltc.Box.prototype.duplicate=function(){return new fmltc.Box(this.x1,this.y1,this.x2,this.y2,this.label)};fmltc.Box.prototype.set=function(a,b,c,d,e){this.x1=Math.min(a,c);this.y1=Math.min(b,d);this.x2=Math.max(a,c);this.y2=Math.max(b,d);this.label=void 0==e?"":e};fmltc.Box.prototype.setXYFromAnotherBox=function(a){this.set(a.x1,a.y1,a.x2,a.y2,this.label)};
fmltc.Box.prototype.resize=function(a,b,c){1==a?(this.x1+=b,this.y1+=c):2==a&&(this.x2+=b,this.y2+=c)};
fmltc.Box.prototype.draw=function(a,b,c){a.lineWidth=Math.round(2/b);a.strokeStyle="#00FF00";a.strokeRect(this.x1,this.y1,this.x2-this.x1,this.y2-this.y1);a.fillStyle="#000000";var d=Math.round(2/b),e=2*d;a.fillRect(this.x1-d,this.y1-d,e,e);a.fillRect(this.x2-d,this.y2-d,e,e);c&&this.label&&(a.fillStyle="#00FF00",a.font=Math.round(30/b)+"px Georgia",b=a.measureText(this.label),a.fillText(this.label,this.x1+2,(this.y1+this.y2+b.actualBoundingBoxAscent)/2))};
fmltc.Box.prototype.getResizeHotspot=function(a,b){b=Math.round(4/b);return Math.abs(a.y-this.y1)<b&&Math.abs(a.x-this.x1)<b?1:Math.abs(a.y-this.y2)<b&&Math.abs(a.x-this.x2)<b?2:0};fmltc.Box.prototype.isEmpty=function(){return this.x1==this.x2&&this.y1==this.y2};fmltc.Util=function(a,b,c){this.pageBasename=a;this.preferences=b;this.startingModels=c;this.currentTabDivId="";this.tabClickListeners=[];this.tabResizeListeners=[];if(a=document.getElementById("logoutButton"))a.onclick=this.logoutButton_onclick.bind(this);this.initializeTabs()};
fmltc.Util.prototype.logoutButton_onclick=function(){var a=new XMLHttpRequest;a.open("POST","/logout",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_logout_onreadystatechange.bind(this,a);a.send()};fmltc.Util.prototype.xhr_logout_onreadystatechange=function(a){4===a.readyState&&(a.onreadystatechange=null,window.location.replace("/"))};fmltc.Util.prototype.setListVideos=function(a){this.listVideos=a};
fmltc.Util.prototype.setListDatasets=function(a){this.listDatasets=a};fmltc.Util.prototype.getListDatasets=function(){return this.listDatasets};fmltc.Util.prototype.setListModels=function(a){this.listModels=a};fmltc.Util.prototype.getListModels=function(){return this.listModels};fmltc.Util.prototype.getPreference=function(a,b){return a in this.preferences?this.preferences[a]:b};
fmltc.Util.prototype.setPreference=function(a,b){if(this.preferences[a]!=b){this.preferences[a]=b;var c=new XMLHttpRequest;a="key="+encodeURIComponent(a)+"&value="+encodeURIComponent(b);c.open("POST","/setUserPreference",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(a)}};fmltc.Util.prototype.setWaitCursor=function(){this.setWaitCursor_(document.body,!0)};fmltc.Util.prototype.hasWaitCursor=function(a){return a.classList&&a.classList.contains("waitCursor")};
fmltc.Util.prototype.clearWaitCursor=function(){this.setWaitCursor_(document.body,!1)};fmltc.Util.prototype.setWaitCursor_=function(a,b){b?this.addClass(a,"waitCursor"):this.removeClass(a,"waitCursor");for(var c=0;c<a.childNodes.length;c++)this.setWaitCursor_(a.childNodes[c],b)};fmltc.Util.prototype.hideElement=function(a){this.addClass(a,"hidden")};fmltc.Util.prototype.showElement=function(a){this.removeClass(a,"hidden")};fmltc.Util.prototype.addClass=function(a,b){a.classList&&a.classList.add(b)};
fmltc.Util.prototype.removeClass=function(a,b){a.classList&&a.classList.remove(b)};fmltc.Util.prototype.getDateTimeString=function(a){var b=new Date(a);a=String(b.getFullYear());var c=b.getMonth()+1;10>c&&(c="0"+c);var d=b.getDate();10>d&&(d="0"+d);var e=b.getHours();10>e&&(e="0"+e);var f=b.getMinutes();10>f&&(f="0"+f);b=b.getSeconds();10>b&&(b="0"+b);return a+c+d+"_"+e+f+b};
fmltc.Util.prototype.initializeTabs=function(){for(var a=!1,b=document.getElementsByClassName("tabButton"),c=0;c<b.length;c++){var d=b[c].id;d.endsWith("Button")||console.log('Error: tabButton with id "'+d+'" should end with "Button".');a=!0;d=d.substring(0,d.length-6);b[c].onclick=this.tabDiv_onclick.bind(this,d)}a&&(this.showLastViewedTab(),this.window_onresize(),window.addEventListener("resize",this.window_onresize.bind(this)))};
fmltc.Util.prototype.window_onresize=function(){for(var a=document.getElementsByClassName("tabDiv"),b=0,c=0;c<a.length;c++){var d=window.getComputedStyle(a[c]);d=a[c].getBoundingClientRect().top+parseFloat(d.getPropertyValue("padding-top"))+parseFloat(d.getPropertyValue("padding-bottom"))+parseFloat(d.getPropertyValue("border-top"))+parseFloat(d.getPropertyValue("border-bottom"));d>b&&(b=d)}b=window.innerHeight-b+"px";for(c=0;c<a.length;c++)for(a[c].style.height=b,d=0;d<this.tabResizeListeners.length;d++)this.tabResizeListeners[d](a[c])};
fmltc.Util.prototype.showLastViewedTab=function(){switch(this.pageBasename){case "root":this.tabDiv_onclick(this.getPreference("root.currentTab","videosTab"));break;case "monitorTraining":this.tabDiv_onclick(this.getPreference("monitorTraining.currentTab","scalarsTab"))}};fmltc.Util.prototype.addTabClickListener=function(a){this.tabClickListeners.push(a)};fmltc.Util.prototype.addTabResizeListener=function(a){this.tabResizeListeners.push(a)};fmltc.Util.prototype.getCurrentTabDivId=function(){return this.currentTabDivId};
fmltc.Util.prototype.showVideosTab=function(){this.tabDiv_onclick("videosTab")};fmltc.Util.prototype.showDatasetsTab=function(){this.tabDiv_onclick("datasetsTab")};fmltc.Util.prototype.showModelsTab=function(){this.tabDiv_onclick("modelsTab")};
fmltc.Util.prototype.tabDiv_onclick=function(a){for(var b=document.getElementsByClassName("tabDiv"),c=0;c<b.length;c++)b[c].style.display="none";b=document.getElementsByClassName("tabButton");for(c=0;c<b.length;c++)b[c].className=b[c].className.replace(" active","");document.getElementById(a+"Div").style.display="block";document.getElementById(a+"Button").className+=" active";this.setPreference(this.pageBasename+".currentTab",a);this.currentTabDivId=a+"Div";for(a=0;a<this.tabClickListeners.length;a++)this.tabClickListeners[a](this.currentTabDivId)};
fmltc.Util.prototype.calculateSecondsSince=function(a){return(Date.now()-Date.parse(a))/1E3};fmltc.Util.prototype.formatElapsedSeconds=function(a){var b=Math.floor(a/3600);a-=3600*b;var c=Math.floor(a/60);a=Math.round(a-60*c);return 0<b?b+":"+String(c).padStart(2,"0")+":"+String(a).padStart(2,"0"):c+":"+String(a).padStart(2,"0")};
fmltc.Util.prototype.checkAllOrNone=function(a,b){if(0!=b.length){for(var c=!1,d=0;d<b.length;d++)if(b[d].checked){c=!0;break}c=!c;for(d=0;d<b.length;d++)b[d].checked=c;a.checked=c}};fmltc.Util.prototype.countChecked=function(a){for(var b=0,c=0;c<a.length;c++)a[c].checked&&b++;return b};fmltc.Util.prototype.insertCellWithClass=function(a,b){a=a.insertCell(-1);this.addClass(a,b);return a};fmltc.Util.prototype.isTrainingDone=function(a){return this.isJobDone(a.train_job_state)&&this.isJobDone(a.eval_job_state)};
fmltc.Util.prototype.isJobDone=function(a){return""==a||"SUCCEEDED"==a||"FAILED"==a||"CANCELLED"==a};fmltc.Util.prototype.isStateChangingSoon=function(a,b){return"STATE_UNSPECIFIED"==b||"QUEUED"==b||"PREPARING"==b||"CANCELLING"==b||this.isStateCancelRequested(a,b)};fmltc.Util.prototype.isStateCancelRequested=function(a,b){return a&&!b.startsWith("CANCEL")};fmltc.Util.prototype.formatJobState=function(a,b){return this.isStateCancelRequested(a,b)?"CANCEL REQUESTED":b};
fmltc.Util.prototype.sortedLabelListsEqual=function(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0};fmltc.Util.prototype.getTable=function(a){for(a=a.parentNode;a&&"TABLE"!=a.tagName;)a=a.parentNode;return a};fmltc.Util.prototype.deleteRowById=function(a){a=document.getElementById(a);this.getTable(a).deleteRow(a.rowIndex)};fmltc.Util.prototype.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};
fmltc.Util.prototype.compare=function(a,b){return a>b?1:a<b?-1:0};fmltc.Util.prototype.compareCaseInsensitive=function(a,b){a=a.toUpperCase();b=b.toUpperCase();return a>b?1:a<b?-1:0};fmltc.Util.prototype.isDisplayed=function(a,b){for(;a&&a!=b;){if("none"==a.style.display)return!1;a=a.parentElement}return!0};fmltc.Util.prototype.isVisible=function(a){a=a.getBoundingClientRect();return 0>a.bottom||a.top>=Math.max(document.documentElement.clientHeight,window.innerHeight)?!1:!0};fmltc.DeleteConfirmationDialog=function(a,b,c,d){this.util=a;this.onYes=d;this.dialog=document.getElementById("deleteConfirmationDialog");this.yesButton=document.getElementById("dcYesButton");this.noButton=document.getElementById("dcNoButton");document.getElementById("dcTitleDiv").textContent=b;document.getElementById("dcMessageDiv").textContent=c;this.yesButton.onclick=this.yesButton_onclick.bind(this);this.noButton.onclick=this.noButton_onclick.bind(this);this.dialog.style.display="block"};
fmltc.DeleteConfirmationDialog.prototype.noButton_onclick=function(){this.dismiss()};fmltc.DeleteConfirmationDialog.prototype.yesButton_onclick=function(){this.dismiss();this.onYes()};fmltc.DeleteConfirmationDialog.prototype.dismiss=function(){this.yesButton.onclick=null;this.noButton.onclick=null;this.dialog.style.display="none"};fmltc.DeleteForbiddenDialog=function(a,b,c,d){this.util=a;this.dialog=document.getElementById("deleteForbiddenDialog");this.okButton=document.getElementById("dfOKButton");document.getElementById("dfTitleDiv").textContent=b;document.getElementById("dfMessageDiv").textContent=c;if(d)for(a=document.getElementById("dfListDiv"),a.innerHTML="",b=0;b<d.length;b++)c=document.createElement("div"),c.textContent=d[b],a.append(c);this.okButton.onclick=this.okButton_onclick.bind(this);this.dialog.style.display=
"block"};fmltc.DeleteForbiddenDialog.prototype.okButton_onclick=function(){this.okButton.onclick=null;this.dialog.style.display="none"};fmltc.DownloadDatasetDialog=function(a,b,c){this.util=a;this.datasetEntity=b;this.downloadStartTime=c;this.dialog=document.getElementById("downloadDatasetDialog");this.dismissButton=document.getElementById("ddDismissButton");this.partitionCountDiv=document.getElementById("ddPartitionCountDiv");this.partitionCountSpan=document.getElementById("ddPartitionCountSpan");this.progressDiv=document.getElementById("ddProgressDiv");this.finishedDiv=document.getElementById("ddFinishedDiv");this.partitionCount=
0;this.downloadStartedArray=[];this.downloadFinishedArray=[];this.zipProgressArray=[];this.zipProgressSpanArray=[];this.downloadProgressArray=[];this.downloadProgressSpanArray=[];document.getElementById("ddRecordCountSpan").textContent=String(this.datasetEntity.total_record_count);this.partitionCountDiv.style.visibility="hidden";this.progressDiv.style.visibility="hidden";this.progressDiv.innerHTML="";this.finishedDiv.style.visibility="hidden";this.dismissButton.disabled=!0;this.dismissButton.onclick=
this.dismissButton_onclick.bind(this);this.dialog.style.display="block";this.prepareToZipDataset()};
fmltc.DownloadDatasetDialog.prototype.dismissButton_onclick=function(){this.downloadStartedArray=[];this.downloadFinishedArray=[];this.zipProgressArray=[];this.zipProgressSpanArray=[];this.downloadProgressArray=[];this.downloadProgressSpanArray=[];this.partitionCountDiv.style.visibility="hidden";this.progressDiv.style.visibility="hidden";this.progressDiv.innerHTML="";this.finishedDiv.style.visibility="hidden";this.dismissButton.onclick=null;this.dialog.style.display="none"};
fmltc.DownloadDatasetDialog.prototype.prepareToZipDataset=function(){var a=new XMLHttpRequest,b="dataset_uuid="+encodeURIComponent(this.datasetEntity.dataset_uuid);a.open("POST","/prepareToZipDataset",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_prepareToZipDataset_onreadystatechange.bind(this,a,b);a.send(b)};
fmltc.DownloadDatasetDialog.prototype.xhr_prepareToZipDataset_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),this.partitionCount=a.partition_count,this.partitionCountSpan.textContent=1==a.partition_count?"1 zip file":String(a.partition_count)+" separate zip files",this.partitionCountDiv.style.visibility="visible",setTimeout(this.getDatasetZipStatus.bind(this,a.dataset_zip_uuid),2E3)):console.log("Failure! /prepareToZipDataset?"+
b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};fmltc.DownloadDatasetDialog.prototype.getDatasetZipStatus=function(a){var b=new XMLHttpRequest,c="dataset_zip_uuid="+encodeURIComponent(a)+"&partition_count="+encodeURIComponent(this.partitionCount);b.open("POST","/getDatasetZipStatus",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_getDatasetZipStatus_onreadystatechange.bind(this,b,c,a);b.send(c)};
fmltc.DownloadDatasetDialog.prototype.xhr_getDatasetZipStatus_onreadystatechange=function(a,b,c){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){a=JSON.parse(a.responseText);if(0==this.downloadStartedArray.length){for(b=0;b<this.partitionCount;b++){this.downloadStartedArray[b]=!1;this.downloadFinishedArray[b]=!1;var d=document.createElement("div"),e=document.createElement("progress");e.value=0;e.max=1;this.zipProgressArray[b]=e;d.appendChild(e);e=document.createElement("span");e.textContent=
this.makeZipProgressLabel(0);this.zipProgressSpanArray[b]=e;d.appendChild(e);this.progressDiv.appendChild(d);d=document.createElement("div");e=document.createElement("progress");e.value=0;e.max=1;this.downloadProgressArray[b]=e;d.appendChild(e);e=document.createElement("span");e.textContent=this.makeDownloadProgressLabel(0);this.downloadProgressSpanArray[b]=e;d.appendChild(e);this.progressDiv.appendChild(d);b!=this.partitionCount-1&&this.progressDiv.appendChild(document.createElement("hr"))}this.progressDiv.style.visibility=
"visible"}b=!0;for(d=0;d<this.partitionCount;d++)this.downloadStartedArray[d]||(this.zipProgressArray[d].value=a.files_written_array[d],this.zipProgressArray[d].max=a.file_count_array[d],this.zipProgressSpanArray[d].textContent=this.makeZipProgressLabel(a.files_written_array[d],a.file_count_array[d]),a.is_ready_array[d]&&a.download_url_array[d]&&(this.downloadStartedArray[d]=!0,this.downloadDatasetZip(c,d,a.download_url_array[d],0))),this.downloadStartedArray[d]||(b=!1);b||setTimeout(this.getDatasetZipStatus.bind(this,
c),2E3)}else console.log("Failure! /getDatasetZipStatus?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),setTimeout(this.getDatasetZipStatus.bind(this,c),5E3)};fmltc.DownloadDatasetDialog.prototype.makeZipProgressLabel=function(a,b){return b?" Dataset files processed: "+a+" of "+b:" Dataset files processed: "+a};
fmltc.DownloadDatasetDialog.prototype.downloadDatasetZip=function(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",c,!0);e.responseType="blob";e.onprogress=this.xhr_downloadDatasetZip_onprogress.bind(this,b);e.onreadystatechange=this.xhr_downloadDatasetZip_onreadystatechange.bind(this,e,a,b,c,d,Date.now());e.send(null)};
fmltc.DownloadDatasetDialog.prototype.xhr_downloadDatasetZip_onprogress=function(a,b){this.downloadProgressArray[a].value=b.loaded;this.downloadProgressArray[a].max=b.total;this.downloadProgressSpanArray[a].textContent=this.makeDownloadProgressLabel(b.loaded,b.total)};fmltc.DownloadDatasetDialog.prototype.makeDownloadProgressLabel=function(a,b){return b?" Bytes downloaded:  "+(new Number(a)).toLocaleString()+" of "+(new Number(b)).toLocaleString():" Bytes downloaded:  "+(new Number(a)).toLocaleString()};
fmltc.DownloadDatasetDialog.prototype.xhr_downloadDatasetZip_onreadystatechange=function(a,b,c,d,e,f){if(4===a.readyState)if(a.onreadystatechange=null,a.onprogress=null,200===a.status){d=document.createElement("a");d.href=window.URL.createObjectURL(a.response);d.download="dataset_"+this.util.getDateTimeString(this.downloadStartTime)+"_"+(c+1)+"_of_"+this.partitionCount+".zip";d.click();c=this.downloadFinishedArray[c]=!0;for(a=0;a<this.partitionCount;a++)this.downloadFinishedArray[a]||(c=!1);c?this.allDone(b):
setTimeout(this.getDatasetZipStatus.bind(this,b),1E3)}else e++,5>e?(a=Math.pow(2,e),console.log("Will retry "+d+" in "+a+" seconds."),setTimeout(this.downloadDatasetZip.bind(this,b,c,d,e),1E3*a)):alert("Unable to download a dataset zip file.")};
fmltc.DownloadDatasetDialog.prototype.allDone=function(a){this.finishedDiv.style.visibility="visibile";for(var b=0;b<this.partitionCount;b++)setTimeout(this.deleteDatasetZip.bind(this,a,b,0),3E4);this.dismissButton.disabled=!1;setTimeout(this.dismissButton_onclick.bind(this),1E3)};
fmltc.DownloadDatasetDialog.prototype.deleteDatasetZip=function(a,b,c){var d=new XMLHttpRequest,e="dataset_zip_uuid="+encodeURIComponent(a)+"&partition_index="+encodeURIComponent(b);d.open("POST","/deleteDatasetZip",!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=this.xhr_deleteDatasetZip_onreadystatechange.bind(this,d,e,a,b,c);d.send(e)};
fmltc.DownloadDatasetDialog.prototype.xhr_deleteDatasetZip_onreadystatechange=function(a,b,c,d,e){4===a.readyState&&(a.onreadystatechange=null,200!==a.status&&(e++,5>e?(a=Math.pow(2,e),console.log("Will retry /deleteDatasetZip in "+a+" seconds."),setTimeout(this.deleteDatasetZip.bind(this,c,d,e),1E3*a)):console.log("Unable to delete a dataset zip file.")))};fmltc.LabelVideo=function(a,b,c){this.util=a;this.videoUuid=b.video_uuid;this.startTime=Date.now();this.dismissButton=document.getElementById("dismissButton");this.smallerImageButton=document.getElementById("smallerImageButton");this.largerImageButton=document.getElementById("largerImageButton");this.loadingProgress=document.getElementById("loadingProgress");this.bboxCanvas=document.getElementById("bboxCanvas");this.videoFrameImg=document.getElementById("videoFrameImg");this.includedFrameCountDiv=
document.getElementById("includedFrameCountDiv");this.includedFrameCountSpan=document.getElementById("includedFrameCountSpan");this.unlabeledFrameCountDiv=document.getElementById("unlabeledFrameCountDiv");this.unlabeledFrameCountSpan=document.getElementById("unlabeledFrameCountSpan");this.currentFrameSpan=document.getElementById("currentFrameSpan");this.includeFrameInDatasetCheckbox=document.getElementById("includeFrameInDatasetCheckbox");this.labelingAreaTable=document.getElementById("labelingAreaTable");
this.drawHintDiv=document.getElementById("drawHintDiv");this.labelHintDiv=document.getElementById("labelHintDiv");this.firstFrameButton=document.getElementById("firstFrameButton");this.previousTenFrameButton=document.getElementById("previousTenFrameButton");this.previousFrameButton=document.getElementById("previousFrameButton");this.nextFrameButton=document.getElementById("nextFrameButton");this.nextTenFrameButton=document.getElementById("nextTenFrameButton");this.lastFrameButton=document.getElementById("lastFrameButton");
this.previousUnlabeledFrameButton=document.getElementById("previousUnlabeledFrameButton");this.nextUnlabeledFrameButton=document.getElementById("nextUnlabeledFrameButton");this.playbackSpeedRangeInput=document.getElementById("playbackSpeedRangeInput");this.reversePlayPauseButton=document.getElementById("reversePlayPauseButton");this.forwardPlayPauseButton=document.getElementById("forwardPlayPauseButton");this.trackerSelect=document.getElementById("trackerSelect");this.trackingScaleInput=document.getElementById("trackingScaleInput");
this.trackingStartButton=document.getElementById("trackingStartButton");this.trackingPauseButton=document.getElementById("trackingPauseButton");this.trackingContinueButton=document.getElementById("trackingContinueButton");this.trackingStopButton=document.getElementById("trackingStopButton");this.trackingStoppedDiv=document.getElementById("trackingStoppedDiv");this.trackingFinishedDiv=document.getElementById("trackingFinishedDiv");this.trackingFailedDiv=document.getElementById("trackingFailedDiv");
this.loadingProgress.value=0;this.bboxCanvasCtx=this.bboxCanvas.getContext("2d");this.canvasScale=1;this.videoEntity=null;this.canvasWidth=Number(this.util.getPreference("canvasWidth",800));this.smallerImageButton.disabled=this.canvasWidth<=fmltc.LabelVideo.MIN_CANVAS_WIDTH;this.largerImageButton.disabled=this.canvasWidth>=fmltc.LabelVideo.MAX_CANVAS_WIDTH;this.videoFrameImage=[];this.videoFrameEntity=[];this.bboxes=[];this.loadedFrameEntityCount=0;this.loadFailed=!1;this.currentFrameNumber=0;this.currentFrameSpan.textContent=
String(this.currentFrameNumber+1);this.unlabeledFrameCount=this.includedFrameCount=0;this.includedFrameCountSpan.textContent=String(this.includedFrameCount);this.unlabeledFrameCountSpan.textContent=String(this.unlabeledFrameCount);this.playing=this.retryingGoToFrame=!1;this.playingDirection=1;this.playingIntervalMs=0;this.resizingBbox=this.definingBbox=null;this.resizingBboxHotspot=this.resizingBboxIndex=0;this.point1=new fmltc.Point;this.point2=new fmltc.Point;this.trackingWaitingForBboxes=this.trackingPaused=
this.trackingInProgress=this.trackingAlreadyInProgress=!1;this.trackingFinalFrameNumber=this.trackingInitFrameNumber=0;this.trackerUuid="";this.trackingRequestSentTime=0;this.updateUI();this.setVideoEntity(b);this.videoFrameEntityLoaded(c,0);a=1;for(b=10;a<this.videoEntity.frame_count;)c=Math.min(a+99,this.videoEntity.frame_count-1),setTimeout(this.retrieveVideoFrameEntitiesWithImageUrls.bind(this,a,c,0),b),a=c+1,b+=10};fmltc.LabelVideo.MIN_CANVAS_WIDTH=500;fmltc.LabelVideo.MAX_CANVAS_WIDTH=2E3;
fmltc.LabelVideo.prototype.setVideoEntity=function(a){this.videoEntity=a;this.minUnlabeledFrameNumber=a.frame_count;this.maxUnlabeledFrameNumber=-1;this.trackingAlreadyInProgress=this.videoEntity.tracking_in_progress;this.loadingProgress.value++;this.loadingProgress.max=1+2*this.videoEntity.frame_count;document.getElementById("descriptionSpan").textContent=this.videoEntity.description;document.getElementById("videoFrameCountSpan").textContent=String(this.videoEntity.frame_count);this.rescaleCanvas();
window.addEventListener("resize",this.repositionCanvas.bind(this));this.dismissButton.onclick=this.dismissButton_onclick.bind(this);this.smallerImageButton.onclick=this.smallerImageButton_onclick.bind(this);this.largerImageButton.onclick=this.largerImageButton_onclick.bind(this);this.bboxCanvas.onmousedown=this.bboxCanvas_onmousedown.bind(this);this.bboxCanvas.onmousemove=this.bboxCanvas_onmousemove.bind(this);this.bboxCanvas.onmouseleave=this.bboxCanvas_onmouseleave.bind(this);this.bboxCanvas.onmouseup=
this.bboxCanvas_onmouseup.bind(this);this.includeFrameInDatasetCheckbox.onclick=this.includeFrameInDatasetCheckbox_onclick.bind(this);this.firstFrameButton.onclick=this.firstFrameButton_onclick.bind(this);this.previousTenFrameButton.onclick=this.previousTenFrameButton_onclick.bind(this);this.previousFrameButton.onclick=this.previousFrameButton_onclick.bind(this);this.nextFrameButton.onclick=this.nextFrameButton_onclick.bind(this);this.nextTenFrameButton.onclick=this.nextTenFrameButton_onclick.bind(this);
this.lastFrameButton.onclick=this.lastFrameButton_onclick.bind(this);this.previousUnlabeledFrameButton.onclick=this.previousUnlabeledFrameButton_onclick.bind(this);this.nextUnlabeledFrameButton.onclick=this.nextUnlabeledFrameButton_onclick.bind(this);this.reversePlayPauseButton.onclick=this.reversePlayPauseButton_onclick.bind(this);this.forwardPlayPauseButton.onclick=this.forwardPlayPauseButton_onclick.bind(this);this.trackingStartButton.onclick=this.trackingStartButton_onclick.bind(this);this.trackingPauseButton.onclick=
this.trackingPauseButton_onclick.bind(this);this.trackingContinueButton.onclick=this.trackingContinueButton_onclick.bind(this);this.trackingStopButton.onclick=this.trackingStopButton_onclick.bind(this);this.updateUI()};fmltc.LabelVideo.prototype.dismissButton_onclick=function(){this.dismissButton.disabled=!0;this.saveBboxes(this.dismissAfterSaveBboxes.bind(this))};fmltc.LabelVideo.prototype.dismissAfterSaveBboxes=function(a){a?window.history.back():this.dismissButton.disabled=!1};
fmltc.LabelVideo.prototype.smallerImageButton_onclick=function(){this.canvasWidth>fmltc.LabelVideo.MIN_CANVAS_WIDTH&&(this.canvasWidth=Math.max(fmltc.LabelVideo.MIN_CANVAS_WIDTH,this.canvasWidth-100),this.smallerImageButton.disabled=this.canvasWidth<=fmltc.LabelVideo.MIN_CANVAS_WIDTH,this.largerImageButton.disabled=this.canvasWidth>=fmltc.LabelVideo.MAX_CANVAS_WIDTH,this.rescaleCanvas(),this.util.setPreference("canvasWidth",this.canvasWidth))};
fmltc.LabelVideo.prototype.largerImageButton_onclick=function(){this.canvasWidth<fmltc.LabelVideo.MAX_CANVAS_WIDTH&&(this.canvasWidth=Math.min(fmltc.LabelVideo.MAX_CANVAS_WIDTH,this.canvasWidth+100),this.smallerImageButton.disabled=this.canvasWidth<=fmltc.LabelVideo.MIN_CANVAS_WIDTH,this.largerImageButton.disabled=this.canvasWidth>=fmltc.LabelVideo.MAX_CANVAS_WIDTH,this.rescaleCanvas(),this.util.setPreference("canvasWidth",this.canvasWidth))};
fmltc.LabelVideo.prototype.rescaleCanvas=function(){this.canvasScale=this.canvasWidth/this.videoEntity.width;this.videoFrameImg.style.width=this.videoEntity.width*this.canvasScale+"px";this.videoFrameImg.style.height=this.videoEntity.height*this.canvasScale+"px";this.repositionCanvas()};
fmltc.LabelVideo.prototype.repositionCanvas=function(){var a=0,b=0,c=this.videoFrameImg;do a+=c.offsetLeft,b+=c.offsetTop,c=c.offsetParent;while(c);this.videoFrameImg.style.zIndex="1";this.bboxCanvas.style.left=a+"px";this.bboxCanvas.style.top=b+"px";this.bboxCanvas.width=this.videoEntity.width;this.bboxCanvas.height=this.videoEntity.height;this.bboxCanvas.style.width=this.videoFrameImg.offsetWidth+"px";this.bboxCanvas.style.height=this.videoFrameImg.offsetHeight+"px";this.bboxCanvas.style.zIndex=
"2";this.redrawBboxes()};fmltc.LabelVideo.prototype.redrawBboxes=function(){this.bboxCanvasCtx.clearRect(0,0,this.videoEntity.width,this.videoEntity.height);if(this.bboxes[this.currentFrameNumber]&&this.videoFrameImage[this.currentFrameNumber])for(var a=0;a<this.bboxes[this.currentFrameNumber].length;a++)this.bboxes[this.currentFrameNumber][a].draw(this.bboxCanvasCtx,this.canvasScale,!1)};
fmltc.LabelVideo.prototype.updateUI=function(){this.videoEntity&&void 0!=this.bboxes[this.currentFrameNumber]?(0==this.bboxes[this.currentFrameNumber].length?this.util.showElement(this.drawHintDiv):this.util.hideElement(this.drawHintDiv),this.missingLabelNames(this.bboxes[this.currentFrameNumber])?(this.util.showElement(this.labelHintDiv),this.firstFrameButton.disabled=!0,this.previousTenFrameButton.disabled=!0,this.previousFrameButton.disabled=!0,this.nextFrameButton.disabled=!0,this.nextTenFrameButton.disabled=
!0,this.lastFrameButton.disabled=!0,this.previousUnlabeledFrameButton.disabled=!0,this.nextUnlabeledFrameButton.disabled=!0,this.playbackSpeedRangeInput.disabled=!0,this.reversePlayPauseButton.disabled=!0,this.forwardPlayPauseButton.disabled=!0,this.includeFrameInDatasetCheckbox.disabled=!0,this.trackingScaleInput.disabled=!0,this.trackerSelect.disabled=!0,this.trackingStartButton.disabled=!0,this.trackingPauseButton.disabled=!0,this.trackingContinueButton.disabled=!0,this.trackingStopButton.disabled=
!0):(this.util.hideElement(this.labelHintDiv),this.playing?(this.firstFrameButton.disabled=!0,this.previousTenFrameButton.disabled=!0,this.previousFrameButton.disabled=!0,this.nextFrameButton.disabled=!0,this.nextTenFrameButton.disabled=!0,this.lastFrameButton.disabled=!0,this.previousUnlabeledFrameButton.disabled=!0,this.nextUnlabeledFrameButton.disabled=!0,this.playbackSpeedRangeInput.disabled=!0,this.reversePlayPauseButton.disabled=1==this.playingDirection,this.forwardPlayPauseButton.disabled=
-1==this.playingDirection,this.includeFrameInDatasetCheckbox.disabled=!0,this.trackingScaleInput.disabled=!0,this.trackerSelect.disabled=!0,this.trackingStartButton.disabled=!0,this.trackingPauseButton.disabled=!0,this.trackingContinueButton.disabled=!0,this.trackingStopButton.disabled=!0):this.trackingInProgress?(this.firstFrameButton.disabled=!0,this.previousTenFrameButton.disabled=!0,this.previousFrameButton.disabled=!0,this.nextFrameButton.disabled=!0,this.nextTenFrameButton.disabled=!0,this.lastFrameButton.disabled=
!0,this.previousUnlabeledFrameButton.disabled=!0,this.nextUnlabeledFrameButton.disabled=!0,this.playbackSpeedRangeInput.disabled=!0,this.reversePlayPauseButton.disabled=!0,this.forwardPlayPauseButton.disabled=!0,this.includeFrameInDatasetCheckbox.disabled=!0,this.trackingScaleInput.disabled=!0,this.trackerSelect.disabled=!0,this.trackingStartButton.disabled=!0,this.trackingPauseButton.disabled=this.trackingPaused,this.trackingContinueButton.disabled=!this.trackingPaused||this.trackingWaitingForBboxes,
this.trackingStopButton.disabled=!this.trackingPaused||this.trackingWaitingForBboxes):(this.firstFrameButton.disabled=0==this.currentFrameNumber,this.previousTenFrameButton.disabled=0==this.currentFrameNumber,this.previousFrameButton.disabled=0==this.currentFrameNumber,this.nextFrameButton.disabled=this.currentFrameNumber==this.videoEntity.frame_count-1,this.nextTenFrameButton.disabled=this.currentFrameNumber==this.videoEntity.frame_count-1,this.lastFrameButton.disabled=this.currentFrameNumber==this.videoEntity.frame_count-
1,this.previousUnlabeledFrameButton.disabled=this.loadedFrameEntityCount<this.videoEntity.frame_count||this.currentFrameNumber<=this.minUnlabeledFrameNumber,this.nextUnlabeledFrameButton.disabled=this.loadedFrameEntityCount<this.videoEntity.frame_count||this.currentFrameNumber>=this.maxUnlabeledFrameNumber,this.playbackSpeedRangeInput.disabled=!1,this.reversePlayPauseButton.disabled=0==this.currentFrameNumber,this.forwardPlayPauseButton.disabled=this.currentFrameNumber==this.videoEntity.frame_count-
1,this.includeFrameInDatasetCheckbox.disabled=!1,this.trackingScaleInput.disabled=!1,this.trackerSelect.disabled=!1,this.trackingStartButton.disabled=this.trackingAlreadyInProgress||this.loadedFrameEntityCount<this.videoEntity.frame_count||0==this.bboxes[this.currentFrameNumber].length||this.currentFrameNumber==this.videoEntity.frame_count-1,this.trackingPauseButton.disabled=!0,this.trackingContinueButton.disabled=!0,this.trackingStopButton.disabled=!0))):(this.firstFrameButton.disabled=!0,this.previousTenFrameButton.disabled=
!0,this.previousFrameButton.disabled=!0,this.nextFrameButton.disabled=!0,this.nextTenFrameButton.disabled=!0,this.lastFrameButton.disabled=!0,this.previousUnlabeledFrameButton.disabled=!0,this.nextUnlabeledFrameButton.disabled=!0,this.playbackSpeedRangeInput.disabled=!0,this.reversePlayPauseButton.disabled=!0,this.forwardPlayPauseButton.disabled=!0,this.includeFrameInDatasetCheckbox.disabled=!0,this.trackingScaleInput.disabled=!0,this.trackerSelect.disabled=!0,this.trackingStartButton.disabled=!0,
this.trackingPauseButton.disabled=!0,this.trackingContinueButton.disabled=!0,this.trackingStopButton.disabled=!0)};fmltc.LabelVideo.prototype.loadFailure=function(){this.loadFailed=!0;document.getElementById("loadingFailedSpan").style.display="inline"};
fmltc.LabelVideo.prototype.retrieveVideoFrameEntitiesWithImageUrls=function(a,b,c){var d=new XMLHttpRequest,e="video_uuid="+encodeURIComponent(this.videoUuid)+"&min_frame_number="+encodeURIComponent(a)+"&max_frame_number="+encodeURIComponent(b);d.open("POST","/retrieveVideoFrameEntitiesWithImageUrls",!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=this.xhr_retrieveVideoFrameEntitiesWithImageUrls_onreadystatechange.bind(this,d,e,a,b,c);d.send(e)};
fmltc.LabelVideo.prototype.xhr_retrieveVideoFrameEntitiesWithImageUrls_onreadystatechange=function(a,b,c,d,e){if(4===a.readyState){a.onreadystatechange=null;if(200===a.status)for(b=JSON.parse(a.responseText).video_frame_entities,c=0;c<b.length;c++)this.videoFrameEntityLoaded(b[c]);else e++,5>e?(a=Math.pow(2,e),console.log("Will retry /retrieveVideoFrameEntitiesWithImageUrls?"+b+" in "+a+" seconds."),setTimeout(this.retrieveVideoFrameEntitiesWithImageUrls.bind(this,c,d,e),1E3*a)):this.loadFailure();
this.updateUI()}};
fmltc.LabelVideo.prototype.videoFrameEntityLoaded=function(a){frameNumber=a.frame_number;this.updateFrameCounts(frameNumber,this.videoFrameEntity[frameNumber]?this.videoFrameEntity[frameNumber].include_frame_in_dataset:!1,this.videoFrameEntity[frameNumber]?this.videoFrameEntity[frameNumber].bboxes_text:"",a.include_frame_in_dataset,a.bboxes_text);this.videoFrameEntity[frameNumber]=a;this.bboxes[frameNumber]=this.convertTextToBboxes(a.bboxes_text);this.loadedFrameEntityCount++;this.loadedFrameEntityCount==this.videoEntity.frame_count&&
(this.includedFrameCountDiv.style.visibility="visible",this.unlabeledFrameCountDiv.style.visibility="visible");this.loadingProgress.value++;setTimeout(this.retrieveVideoFrameImage.bind(this,frameNumber,a.image_url,0),0);frameNumber==this.currentFrameNumber&&(this.redrawBboxes(),this.refillLabelingArea())};
fmltc.LabelVideo.prototype.updateFrameCounts=function(a,b,c,d,e){b?d||(this.includedFrameCount--,this.includedFrameCountSpan.textContent=String(this.includedFrameCount)):d&&(this.includedFrameCount++,this.includedFrameCountSpan.textContent=String(this.includedFrameCount));b&&""==c?d&&""==e||(this.unlabeledFrameCount--,this.unlabeledFrameCountSpan.textContent=String(this.unlabeledFrameCount),a==this.minUnlabeledFrameNumber&&(this.minUnlabeledFrameNumber=this.findNextUnlabeledFrameNumber(a+1)),a==this.maxUnlabeledFrameNumber&&
(this.maxUnlabeledFrameNumber=this.findPreviousUnlabeledFrameNumber(a-1))):d&&""==e&&(this.unlabeledFrameCount++,this.unlabeledFrameCountSpan.textContent=String(this.unlabeledFrameCount),a<this.minUnlabeledFrameNumber&&(this.minUnlabeledFrameNumber=a),a>this.maxUnlabeledFrameNumber&&(this.maxUnlabeledFrameNumber=a))};
fmltc.LabelVideo.prototype.retrieveVideoFrameImage=function(a,b,c){var d=new XMLHttpRequest;b||(b="/retrieveVideoFrameImage?video_uuid="+encodeURIComponent(this.videoUuid)+"&frame_number="+encodeURIComponent(a));d.open("GET",b,!0);d.responseType="blob";d.onreadystatechange=this.xhr_retrieveVideoFrameImage_onreadystatechange.bind(this,d,a,b,c);d.send(null)};
fmltc.LabelVideo.prototype.xhr_retrieveVideoFrameImage_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(this.videoFrameImage[b]=window.URL.createObjectURL(a.response),this.loadingProgress.value++,this.loadingProgress.value==this.loadingProgress.max&&(c=Date.now()-this.startTime,console.log("Loading all frames took "+c+" ms")),b==this.currentFrameNumber&&(this.updateVideoFrameImg(),this.redrawBboxes())):(d++,5>d?(a=Math.pow(2,d),console.log("Will retry "+
c+" in "+a+" seconds."),setTimeout(this.retrieveVideoFrameImage.bind(this,b,c,d),1E3*a)):this.loadFailure()),this.updateUI())};fmltc.LabelVideo.prototype.convertTextToBboxes=function(a){var b=[];if(a){a=a.split("\n");for(var c=0;c<a.length;c++)if(a[c]){var d=a[c].split(",");5==d.length?b[c]=new fmltc.Box(Number(d[0]),Number(d[1]),Number(d[2]),Number(d[3]),d[4]):console.log('Failed to split line into 5 tokens: "'+a[c]+'".')}}return b};
fmltc.LabelVideo.prototype.convertBboxesToText=function(a){for(var b="",c=0;c<a.length;c++){var d=a[c];b+=Math.min(d.x1,d.x2)+","+Math.min(d.y1,d.y2)+","+Math.max(d.x1,d.x2)+","+Math.max(d.y1,d.y2)+","+d.label+"\n"}return b};fmltc.LabelVideo.prototype.missingLabelNames=function(a){if(a)for(var b=0;b<a.length;b++)if(!a[b].label)return!0;return!1};
fmltc.LabelVideo.prototype.saveBboxes=function(a){if(void 0==this.bboxes[this.currentFrameNumber]||void 0==this.videoFrameEntity[this.currentFrameNumber])return a&&a(!0),"";var b=this.videoFrameEntity[this.currentFrameNumber].bboxes_text,c=this.convertBboxesToText(this.bboxes[this.currentFrameNumber]);if(c==b)return a&&a(!0),c;var d=this.videoFrameEntity[this.currentFrameNumber].include_frame_in_dataset;this.updateFrameCounts(this.currentFrameNumber,d,b,d,c);this.videoFrameEntity[this.currentFrameNumber].bboxes_text=
c;b=new XMLHttpRequest;d="video_uuid="+encodeURIComponent(this.videoUuid)+"&frame_number="+encodeURIComponent(this.currentFrameNumber)+"&bboxes_text="+encodeURIComponent(c);b.open("POST","/storeVideoFrameBboxesText",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_storeVideoFrameBboxesText_onreadystatechange.bind(this,b,d,this.currentFrameNumber,a);b.send(d);return c};
fmltc.LabelVideo.prototype.xhr_storeVideoFrameBboxesText_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,200===a.status?d&&d(!0):(d&&d(!1),console.log("Failure! /storeVideoFrameBboxesText?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText)))};fmltc.LabelVideo.prototype.updateVideoFrameImg=function(){this.videoFrameImg.src=this.videoFrameImage[this.currentFrameNumber]?this.videoFrameImage[this.currentFrameNumber]:"//:0"};
fmltc.LabelVideo.prototype.refillLabelingArea=function(a){for(var b=this.labelingAreaTable.rows.length-1;1<=b;b--)this.removeEventHandlers(this.labelingAreaTable.rows[b]),this.labelingAreaTable.deleteRow(b);if(void 0!=this.bboxes[this.currentFrameNumber]){this.includeFrameInDatasetCheckbox.checked=this.videoFrameEntity[this.currentFrameNumber].include_frame_in_dataset;b=["x1","y1","x2","y2","label"];for(var c=["number","number","number","number","text"],d=["7ch","7ch","7ch","7ch","113px"],e=null,
f=0;f<this.bboxes[this.currentFrameNumber].length;f++){for(var g=this.bboxes[this.currentFrameNumber][f],k=this.labelingAreaTable.insertRow(-1),h=0;h<b.length;h++){e=b[h];var m=this.util.insertCellWithClass(k,"cellWithBorderLeftPadding"),l=document.createElement("input");this.util.addClass(l,"inputWithoutBorder");this.util.addClass(l,"text-16");"number"==c[h]&&this.util.addClass(l,"rightText");l.setAttribute("type",c[h]);l.style.width=d[h];l.value=g[e];l.oninput=this.bboxFieldInput_oninput.bind(this,
f,l,e);m.appendChild(l);e=l}td=this.util.insertCellWithClass(k,"cellWithBorderLeftPadding");g=document.createElement("button");this.util.addClass(g,"material-icons");this.util.addClass(g,"text-16");this.util.addClass(g,"buttonWithoutBorder");g.textContent="delete";g.title="Delete this box";g.onclick=this.deleteButton_onclick.bind(this,k);td.appendChild(g)}a&&e&&e.focus()}};
fmltc.LabelVideo.prototype.removeEventHandlers=function(a){"INPUT"==a.nodeName?a.oninput=null:"BUTTON"==a.nodeName&&(a.onclick=null);for(var b=0;b<a.childNodes.length;b++)this.removeEventHandlers(a.childNodes[b])};fmltc.LabelVideo.prototype.bboxFieldInput_oninput=function(a,b,c){a<this.bboxes[this.currentFrameNumber].length&&(this.bboxes[this.currentFrameNumber][a][c]=b.value,this.redrawBboxes(),this.saveBboxes());this.updateUI()};
fmltc.LabelVideo.prototype.deleteButton_onclick=function(a){a=a.rowIndex-1;a<this.bboxes[this.currentFrameNumber].length&&(this.bboxes[this.currentFrameNumber].splice(a,1),this.redrawBboxes(),this.refillLabelingArea(),this.updateUI(),this.saveBboxes())};fmltc.LabelVideo.prototype.needToRetryGoToFrame=function(a){return void 0==this.videoFrameEntity[a]?!0:!1};
fmltc.LabelVideo.prototype.goToFrame=function(a){if(this.needToRetryGoToFrame(a))return this.retryingGoToFrame=!0,setTimeout(this.goToFrameRetry.bind(this,a,0),1E3),!1;this.saveBboxes();this.retryingGoToFrame&&(this.retryingGoToFrame=!1,this.playing&&setTimeout(this.advanceFrame.bind(this),this.playingIntervalMs));this.currentFrameNumber=a;this.currentFrameSpan.textContent=String(this.currentFrameNumber+1);this.updateVideoFrameImg();this.redrawBboxes();this.refillLabelingArea();this.updateUI();return!0};
fmltc.LabelVideo.prototype.goToFrameRetry=function(a,b){this.retryingGoToFrame&&(this.needToRetryGoToFrame(a)?20>b&&setTimeout(this.goToFrameRetry.bind(this,a,b+1),1E3):this.goToFrame(a))};
fmltc.LabelVideo.prototype.includeFrameInDatasetCheckbox_onclick=function(){if(void 0!=this.videoFrameEntity[this.currentFrameNumber]){var a=this.videoFrameEntity[this.currentFrameNumber].include_frame_in_dataset,b=this.includeFrameInDatasetCheckbox.checked;if(b!=a){var c=this.videoFrameEntity[this.currentFrameNumber].bboxes_text;this.updateFrameCounts(this.currentFrameNumber,a,c,b,c);this.videoFrameEntity[this.currentFrameNumber].include_frame_in_dataset=b;a=new XMLHttpRequest;b="video_uuid="+encodeURIComponent(this.videoUuid)+
"&frame_number="+encodeURIComponent(this.currentFrameNumber)+"&include_frame_in_dataset="+encodeURIComponent(b);a.open("POST","/storeVideoFrameIncludeInDataset",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_storeVideoFrameIncludeInDataset_onreadystatechange.bind(this,a,b,this.currentFrameNumber);a.send(b)}}};
fmltc.LabelVideo.prototype.xhr_storeVideoFrameIncludeInDataset_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200!==a.status&&console.log("Failure! /storeVideoFrameIncludeInDataset?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};fmltc.LabelVideo.prototype.firstFrameButton_onclick=function(){this.goToFrame(0)};fmltc.LabelVideo.prototype.previousTenFrameButton_onclick=function(){this.goToFrame(Math.max(0,this.currentFrameNumber-10))};
fmltc.LabelVideo.prototype.previousFrameButton_onclick=function(){this.goToFrame(this.currentFrameNumber-1)};fmltc.LabelVideo.prototype.nextFrameButton_onclick=function(){this.goToFrame(this.currentFrameNumber+1)};fmltc.LabelVideo.prototype.nextTenFrameButton_onclick=function(){this.goToFrame(Math.min(this.currentFrameNumber+10,this.videoEntity.frame_count-1))};fmltc.LabelVideo.prototype.lastFrameButton_onclick=function(){this.goToFrame(this.videoEntity.frame_count-1)};
fmltc.LabelVideo.prototype.previousUnlabeledFrameButton_onclick=function(){var a=this.findPreviousUnlabeledFrameNumber(this.currentFrameNumber-1);0<=a&&this.goToFrame(a)};fmltc.LabelVideo.prototype.findPreviousUnlabeledFrameNumber=function(a){for(;0<=a;a++)if(""==this.videoFrameEntity[a].bboxes_text)return a;return-1};fmltc.LabelVideo.prototype.nextUnlabeledFrameButton_onclick=function(){var a=this.findNextUnlabeledFrameNumber(this.currentFrameNumber+1);a<this.videoEntity.frame_count&&this.goToFrame(a)};
fmltc.LabelVideo.prototype.findNextUnlabeledFrameNumber=function(a){for(;a<this.videoEntity.frame_count;a++)if(""==this.videoFrameEntity[a].bboxes_text)return a;return this.videoEntity.frame_count};
fmltc.LabelVideo.prototype.reversePlayPauseButton_onclick=function(){this.saveBboxes();this.playing=!this.playing;this.reversePlayPauseButton.textContent=this.playing?"pause":"play_arrow";this.updateUI();this.playing&&(this.playingDirection=-1,this.playingIntervalMs=Math.round(1E3/this.playbackSpeedRangeInput.value),this.advanceFrame())};
fmltc.LabelVideo.prototype.forwardPlayPauseButton_onclick=function(){this.saveBboxes();this.playing=!this.playing;this.forwardPlayPauseButton.textContent=this.playing?"pause":"play_arrow";this.updateUI();this.playing&&(this.playingDirection=1,this.playingIntervalMs=Math.round(1E3/this.playbackSpeedRangeInput.value),this.advanceFrame())};
fmltc.LabelVideo.prototype.advanceFrame=function(){if(this.playing){var a=this.currentFrameNumber+this.playingDirection;this.goToFrame(a)&&((-1==this.playingDirection?0==a:a==this.videoEntity.frame_count-1)?(this.playing=!1,this.reversePlayPauseButton.textContent="play_arrow",this.forwardPlayPauseButton.textContent="play_arrow",this.updateUI()):setTimeout(this.advanceFrame.bind(this),this.playingIntervalMs))}};
fmltc.LabelVideo.prototype.bboxCanvas_onmousedown=function(a){if(!this.playing&&(!this.trackingInProgress||this.trackingPaused&&!this.trackingWaitingForBboxes)&&void 0!=this.bboxes[this.currentFrameNumber]){this.point1.fromMouseEvent(a,this.bboxCanvas,this.canvasScale);for(var b=a=0;b<this.bboxes[this.currentFrameNumber].length&&!(a=this.bboxes[this.currentFrameNumber][b].getResizeHotspot(this.point1,this.canvasScale));)b++;a?(this.resizingBboxIndex=b,this.resizingBboxHotspot=a,this.resizingBbox=
this.bboxes[this.currentFrameNumber][b].duplicate()):(this.definingBbox=new fmltc.Box(this.point1.x,this.point1.y,this.point1.x,this.point1.y,""),this.definingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1))}};
fmltc.LabelVideo.prototype.bboxCanvas_onmousemove=function(a){if(this.playing||this.trackingInProgress&&(!this.trackingPaused||this.trackingWaitingForBboxes)||void 0==this.bboxes[this.currentFrameNumber])this.util.hasWaitCursor(this.bboxCanvas)||(this.bboxCanvas.style.cursor="auto");else if(this.definingBbox)this.bboxCanvasCtx.globalCompositeOperation="destination-out",this.definingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1),this.bboxCanvasCtx.globalCompositeOperation="source-over",this.point2.fromMouseEvent(a,
this.bboxCanvas,this.canvasScale),this.definingBbox.set(this.point1.x,this.point1.y,this.point2.x,this.point2.y),this.definingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1);else if(this.resizingBbox)this.bboxCanvasCtx.globalCompositeOperation="destination-out",this.resizingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1),this.bboxCanvasCtx.globalCompositeOperation="source-over",this.point2.fromMouseEvent(a,this.bboxCanvas,this.canvasScale),this.resizingBbox.resize(this.resizingBboxHotspot,this.point2.x-
this.point1.x,this.point2.y-this.point1.y),this.point1.fromAnotherPoint(this.point2),this.resizingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1);else{this.point1.fromMouseEvent(a,this.bboxCanvas,this.canvasScale);for(var b=a=0;b<this.bboxes[this.currentFrameNumber].length;b++)if(a=this.bboxes[this.currentFrameNumber][b].getResizeHotspot(this.point1,this.canvasScale)){this.bboxCanvas.style.cursor="nwse-resize";break}a||(this.bboxCanvas.style.cursor="crosshair")}};
fmltc.LabelVideo.prototype.bboxCanvas_onmouseleave=function(a){this.definingBbox?(this.bboxCanvasCtx.globalCompositeOperation="destination-out",this.definingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1),this.bboxCanvasCtx.globalCompositeOperation="source-over",this.definingBbox=null,this.redrawBboxes()):this.resizingBbox&&(this.bboxCanvasCtx.globalCompositeOperation="destination-out",this.resizingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1),this.bboxCanvasCtx.globalCompositeOperation="source-over",
this.resizingBbox=null,this.redrawBboxes())};
fmltc.LabelVideo.prototype.bboxCanvas_onmouseup=function(a){this.definingBbox?(this.bboxCanvasCtx.globalCompositeOperation="destination-out",this.definingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1),this.bboxCanvasCtx.globalCompositeOperation="source-over",this.definingBbox.isEmpty()||this.bboxes[this.currentFrameNumber].push(this.definingBbox),this.updateUI(),this.definingBbox=null,this.redrawBboxes(),this.refillLabelingArea(!0),this.saveBboxes()):this.resizingBbox&&(this.bboxCanvasCtx.globalCompositeOperation=
"destination-out",this.resizingBbox.draw(this.bboxCanvasCtx,this.canvasScale,!1),this.bboxCanvasCtx.globalCompositeOperation="source-over",this.bboxes[this.currentFrameNumber][this.resizingBboxIndex].setXYFromAnotherBox(this.resizingBbox),this.resizingBbox=null,this.redrawBboxes(),this.refillLabelingArea(),this.saveBboxes())};
fmltc.LabelVideo.prototype.trackingStartButton_onclick=function(){this.trackingFinishedDiv.style.visibility="hidden";this.trackingFailedDiv.style.visibility="hidden";this.trackingStoppedDiv.style.visibility="hidden";this.trackingInProgress=!0;this.trackingPaused=!1;this.trackingWaitingForBboxes=!0;this.trackingInitFrameNumber=this.currentFrameNumber;this.trackingFinalFrameNumber=this.videoEntity.frame_count-1;this.util.setWaitCursor();this.updateUI();var a=this.saveBboxes(),b=new XMLHttpRequest;a=
"video_uuid="+encodeURIComponent(this.videoUuid)+"&init_frame_number="+encodeURIComponent(this.currentFrameNumber)+"&init_bboxes_text="+encodeURIComponent(a)+"&tracker_name="+encodeURIComponent(this.trackerSelect.options[this.trackerSelect.selectedIndex].value)+"&scale="+encodeURIComponent(this.trackingScaleInput.value);b.open("POST","/prepareToStartTracking",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_prepareToStartTracking_onreadystatechange.bind(this,
b,a,this.currentFrameNumber);b.send(a);this.trackingRequestSent()};
fmltc.LabelVideo.prototype.xhr_prepareToStartTracking_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(this.trackerUuid=JSON.parse(a.responseText).tracker_uuid,setTimeout(this.retrieveTrackedBboxes.bind(this,c+1,0),1E3),setTimeout(this.trackingClientStillAlive.bind(this),3E4)):(console.log("Failure! /prepareToStartTracking?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),this.util.clearWaitCursor(),this.trackingWaitingForBboxes=this.trackingPaused=
this.trackingInProgress=!1,this.trackingFailedDiv.style.visibility="visible",this.updateUI()))};fmltc.LabelVideo.prototype.trackingRequestSent=function(){this.trackingRequestSentTime=Date.now()};
fmltc.LabelVideo.prototype.trackingClientStillAlive=function(){if(this.trackingInProgress){if(3E4<=Date.now()-this.trackingRequestSentTime){var a=new XMLHttpRequest,b="video_uuid="+encodeURIComponent(this.videoUuid)+"&tracker_uuid="+encodeURIComponent(this.trackerUuid);a.open("POST","/trackingClientStillAlive",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_trackingClientStillAlive_onreadystatechange.bind(this,a,b);a.send(b);this.trackingRequestSent()}setTimeout(this.trackingClientStillAlive.bind(this),
3E4)}};fmltc.LabelVideo.prototype.xhr_trackingClientStillAlive_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200!==a.status&&console.log("Failure! /trackingClientStillAlive?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};
fmltc.LabelVideo.prototype.retrieveTrackedBboxes=function(a,b){var c=new XMLHttpRequest,d="video_uuid="+encodeURIComponent(this.videoUuid)+"&tracker_uuid="+encodeURIComponent(this.trackerUuid)+"&retrieve_frame_number="+encodeURIComponent(a);c.open("POST","/retrieveTrackedBboxes",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_retrieveTrackedBboxes_onreadystatechange.bind(this,c,d,a,b);c.send(d);this.trackingRequestSent()};
fmltc.LabelVideo.prototype.xhr_retrieveTrackedBboxes_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(d=JSON.parse(a.responseText),d.tracker_failed?(this.util.clearWaitCursor(),this.trackingWaitingForBboxes=this.trackingPaused=this.trackingInProgress=!1,alert("Tracker failed. It will be restarted after you dismiss this alert."),setTimeout(this.trackingStartButton_onclick.bind(this),1E3)):d.frame_number==c?(d=d.bboxes_text,a=this.videoFrameEntity[c].include_frame_in_dataset,
this.updateFrameCounts(c,a,this.videoFrameEntity[c].bboxes_text,a,d),this.videoFrameEntity[c].bboxes_text=d,this.bboxes[c]=this.convertTextToBboxes(this.videoFrameEntity[c].bboxes_text),this.trackingWaitingForBboxes=!1,c==this.trackingInitFrameNumber+1&&this.util.clearWaitCursor(),this.goToFrame(c),this.trackingPaused||this.sendContinueTracking(0)):setTimeout(this.retrieveTrackedBboxes.bind(this,c,0),100)):(d++,5>d?(a=Math.pow(2,d),setTimeout(this.retrieveTrackedBboxes.bind(this,c,d),1E3*a)):(this.util.clearWaitCursor(),
this.trackingWaitingForBboxes=this.trackingPaused=this.trackingInProgress=!1,this.trackingFailedDiv.style.visibility="visible")),this.updateUI())};fmltc.LabelVideo.prototype.trackingPauseButton_onclick=function(){this.trackingPaused=!0;this.updateUI()};fmltc.LabelVideo.prototype.trackingContinueButton_onclick=function(){this.trackingPaused=!1;this.sendContinueTracking(0)};
fmltc.LabelVideo.prototype.sendContinueTracking=function(a){this.trackingWaitingForBboxes=!0;this.updateUI();this.videoFrameEntity[this.currentFrameNumber].bboxes_text=this.convertBboxesToText(this.bboxes[this.currentFrameNumber]);var b=new XMLHttpRequest,c="video_uuid="+encodeURIComponent(this.videoUuid)+"&tracker_uuid="+encodeURIComponent(this.trackerUuid)+"&frame_number="+encodeURIComponent(this.currentFrameNumber)+"&bboxes_text="+encodeURIComponent(this.videoFrameEntity[this.currentFrameNumber].bboxes_text);
b.open("POST","/continueTracking",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.currentFrameNumber<this.trackingFinalFrameNumber?(a=this.currentFrameNumber+1,c+="&retrieve_frame_number="+encodeURIComponent(a),b.onreadystatechange=this.xhr_retrieveTrackedBboxes_onreadystatechange.bind(this,b,c,a,0)):b.onreadystatechange=this.xhr_continueTracking_onreadystatechange.bind(this,b,c,a);b.send(c);this.trackingRequestSent()};
fmltc.LabelVideo.prototype.xhr_continueTracking_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(this.trackingWaitingForBboxes=this.trackingPaused=this.trackingInProgress=!1,this.trackingFinishedDiv.style.visibility="visible",this.updateUI()):(c++,5>c&&(a=Math.pow(2,c),setTimeout(this.sendContinueTracking.bind(this,c),1E3*a))))};
fmltc.LabelVideo.prototype.trackingStopButton_onclick=function(){var a=new XMLHttpRequest,b="video_uuid="+encodeURIComponent(this.videoUuid)+"&tracker_uuid="+encodeURIComponent(this.trackerUuid);a.open("POST","/stopTracking",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_stopTracking_onreadystatechange.bind(this,a,b);a.send(b)};
fmltc.LabelVideo.prototype.xhr_stopTracking_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(this.trackingWaitingForBboxes=this.trackingPaused=this.trackingInProgress=!1,this.trackingStoppedDiv.style.visibility="visible",this.updateUI()):console.log("Failure! /stopTracking?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};fmltc.ListDatasets=function(a){this.util=a;this.datasetsListDiv=document.getElementById("datasetsListDiv");this.datasetsTable=document.getElementById("datasetsTable");this.datasetCheckboxAll=document.getElementById("datasetCheckboxAll");this.downloadDatasetButton=document.getElementById("downloadDatasetButton");this.startTrainingButton=document.getElementById("startTrainingButton");this.deleteDatasetsButton=document.getElementById("deleteDatasetsButton");this.headerRowCount=this.datasetsTable.rows.length;
this.datasetEntityArray=[];this.checkboxes=[];this.waitCursor=!1;this.deleteDatasetCounter=0;this.retrieveDatasetEntities();this.updateButtons();this.datasetCheckboxAll.onclick=this.datasetCheckboxAll_onclick.bind(this);this.downloadDatasetButton.onclick=this.downloadDatasetButton_onclick.bind(this);this.startTrainingButton.onclick=this.startTrainingButton_onclick.bind(this);this.deleteDatasetsButton.onclick=this.deleteDatasetsButton_onclick.bind(this)};
fmltc.ListDatasets.prototype.retrieveDatasetEntities=function(){var a=new XMLHttpRequest;a.open("POST","/retrieveDatasetEntities",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_retrieveDatasetEntities_onreadystatechange.bind(this,a);a.send()};
fmltc.ListDatasets.prototype.xhr_retrieveDatasetEntities_onreadystatechange=function(a){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){a=JSON.parse(a.responseText).dataset_entities;for(var b=0;b<a.length;b++)a[b].dataset_completed&&this.addDataset(a[b]);document.getElementById("datasetsLoader").style.visibility="hidden"}else console.log("Failure! /retrieveDatasetEntities? xhr.status is "+a.status+". xhr.statusText is "+a.statusText)};
fmltc.ListDatasets.prototype.addDataset=function(a){var b=this.datasetEntityArray.length;this.datasetEntityArray.push(a);var c=this.datasetsTable.insertRow(-1),d=this.util.insertCellWithClass(c,"cellWithBorder"),e=document.createElement("input");this.checkboxes[b]=e;e.setAttribute("type","checkbox");e.onclick=this.checkbox_onclick.bind(this);d.appendChild(e);this.util.insertCellWithClass(c,"cellWithBorder").textContent=(new Date(a.create_time_ms)).toLocaleString();this.util.insertCellWithClass(c,
"cellWithBorder").textContent=a.description;b=this.util.insertCellWithClass(c,"cellWithBorder");b.setAttribute("align","right");b.textContent=(new Number(a.train_frame_count)).toLocaleString();b=this.util.insertCellWithClass(c,"cellWithBorder");b.setAttribute("align","right");b.textContent=(new Number(a.train_negative_frame_count)).toLocaleString();b=this.util.insertCellWithClass(c,"cellWithBorder");b.setAttribute("align","right");b.textContent=(new Number(a.eval_frame_count)).toLocaleString();b=
this.util.insertCellWithClass(c,"cellWithBorder");b.setAttribute("align","right");b.textContent=(new Number(a.eval_negative_frame_count)).toLocaleString();c=this.util.insertCellWithClass(c,"cellWithBorder");for(b=0;b<a.sorted_label_list.length;b++)d=document.createElement("div"),d.textContent=a.sorted_label_list[b],c.appendChild(d);1==this.datasetEntityArray.length&&(this.datasetsListDiv.style.display="block")};fmltc.ListDatasets.prototype.addNewDataset=function(a){this.addDataset(a)};
fmltc.ListDatasets.prototype.datasetCheckboxAll_onclick=function(){this.util.checkAllOrNone(this.datasetCheckboxAll,this.checkboxes);this.updateButtons()};fmltc.ListDatasets.prototype.checkbox_onclick=function(){this.updateButtons()};
fmltc.ListDatasets.prototype.deleteDatasetsButton_onclick=function(){var a=this.getCheckedDatasetUuids(),b=JSON.stringify(a),c=new XMLHttpRequest;b="dataset_uuids="+encodeURIComponent(b);c.open("POST","/canDeleteDatasets",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_canDeleteDatasets_onreadystatechange.bind(this,c,b,a);c.send(b)};
fmltc.ListDatasets.prototype.xhr_canDeleteDatasets_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),a.can_delete_datasets?new fmltc.DeleteConfirmationDialog(this.util,"Delete Datasets","Are you sure you want to delete the selected datasets?",this.deleteDatasets.bind(this,c)):new fmltc.DeleteForbiddenDialog(this.util,"Delete Datasets","The selected datasets cannot be deleted.",a.messages)):console.log("Failure! /canDeleteDatasets?"+
b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};
fmltc.ListDatasets.prototype.deleteDatasets=function(a){this.waitCursor=!0;this.util.setWaitCursor();this.updateButtons();for(var b=this.deleteDatasetCounter=0;b<a.length;b++){var c=a[b],d=new XMLHttpRequest,e="dataset_uuid="+encodeURIComponent(c);d.open("POST","/deleteDataset",!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=this.xhr_deleteDataset_onreadystatechange.bind(this,d,e,c);d.send(e);this.deleteDatasetCounter++}};
fmltc.ListDatasets.prototype.xhr_deleteDataset_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,this.deleteDatasetCounter--,0==this.deleteDatasetCounter&&(this.util.clearWaitCursor(),this.waitCursor=!1,this.updateButtons()),200===a.status?(a=this.indexOfDataset(c),-1!=a&&(this.datasetsTable.deleteRow(a+this.headerRowCount),this.datasetEntityArray.splice(a,1),this.checkboxes[a].onclick=null,this.checkboxes.splice(a,1),this.updateButtons(),0==this.datasetEntityArray.length&&
(this.datasetsListDiv.style.display="none"))):console.log("Failure! /deleteDataset?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};fmltc.ListDatasets.prototype.indexOfDataset=function(a){for(var b=0;b<this.datasetEntityArray.length;b++)if(this.datasetEntityArray[b].dataset_uuid==a)return b;return-1};
fmltc.ListDatasets.prototype.updateButtons=function(){for(var a=0,b=!0,c=null,d=0;d<this.checkboxes.length;d++)this.checkboxes[d].checked&&(a++,null==c?c=this.datasetEntityArray[d].sorted_label_list:this.util.sortedLabelListsEqual(c,this.datasetEntityArray[d].sorted_label_list)||(b=!1));this.downloadDatasetButton.disabled=this.waitCursor||1!=a;this.startTrainingButton.disabled=this.waitCursor||0==a||!b;this.deleteDatasetsButton.disabled=this.waitCursor||0==a};
fmltc.ListDatasets.prototype.getCheckedDatasetUuids=function(){for(var a=[],b=0;b<this.checkboxes.length;b++)this.checkboxes[b].checked&&a.push(this.datasetEntityArray[b].dataset_uuid);return a};fmltc.ListDatasets.prototype.downloadDatasetButton_onclick=function(){this.updateButtons();for(var a=0;a<this.checkboxes.length;a++)if(this.checkboxes[a].checked){var b=Date.now();new fmltc.DownloadDatasetDialog(this.util,this.datasetEntityArray[a],b);break}};
fmltc.ListDatasets.prototype.startTrainingButton_onclick=function(){var a=this.getCheckedDatasetUuids(),b=this.util.getListModels();new fmltc.StartTrainingDialog(this.util,b.totalTrainingMinutes,b.remainingTrainingMinutes,a,this.onTrainingStarted.bind(this))};fmltc.ListDatasets.prototype.onTrainingStarted=function(a,b){this.util.getListModels().addNewModel(a,b);this.util.showModelsTab()};
fmltc.ListDatasets.prototype.getDatasetsWithLabels=function(a){for(var b=[],c=0;c<this.datasetEntityArray.length;c++)this.util.sortedLabelListsEqual(a,this.datasetEntityArray[c].sorted_label_list)&&b.push(this.datasetEntityArray[c]);return b};fmltc.ListModels=function(a){this.util=a;this.modelsListDiv=document.getElementById("modelsListDiv");this.modelsTable=document.getElementById("modelsTable");this.modelCheckboxAll=document.getElementById("modelCheckboxAll");this.trainMoreButton=document.getElementById("trainMoreButton");this.downloadTFLiteButton=document.getElementById("downloadTFLiteButton");this.cancelTrainingButton=document.getElementById("cancelTrainingButton");this.deleteModelsButton=document.getElementById("deleteModelsButton");
this.headerRowCount=this.modelsTable.rows.length;this.modelEntityArray=[];this.trs=[];this.checkboxes=[];this.trainStateTds=[];this.trainedStepsTds=[];this.trainTimeTds=[];this.trainingDone=[];this.trainTimeIntervalId=0;this.waitCursor=!1;this.remainingTrainingMinutes=this.totalTrainingMinutes=this.deleteModelCounter=0;this.retrieveModelEntities();this.updateButtons();this.modelCheckboxAll.onclick=this.modelCheckboxAll_onclick.bind(this);this.trainMoreButton.onclick=this.trainMoreButton_onclick.bind(this);
this.downloadTFLiteButton.onclick=this.downloadTFLiteButton_onclick.bind(this);this.cancelTrainingButton.onclick=this.cancelTrainingButton_onclick.bind(this);this.deleteModelsButton.onclick=this.deleteModelsButton_onclick.bind(this)};
fmltc.ListModels.prototype.retrieveModelEntities=function(){var a=new XMLHttpRequest;a.open("POST","/retrieveModelEntities",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_retrieveModelEntities_onreadystatechange.bind(this,a);a.send()};
fmltc.ListModels.prototype.xhr_retrieveModelEntities_onreadystatechange=function(a){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){a=JSON.parse(a.responseText);this.totalTrainingMinutes=Math.floor(a.total_training_minutes);this.remainingTrainingMinutes=Math.floor(a.remaining_training_minutes);a=a.model_entities;for(var b=0;b<a.length;b++)this.onModelEntityUpdated(a[b]);document.getElementById("modelsLoader").style.visibility="hidden"}else console.log("Failure! /retrieveModelEntities? xhr.status is "+
a.status+". xhr.statusText is "+a.statusText)};
fmltc.ListModels.prototype.onModelEntityUpdated=function(a){var b=this.indexOfModel(a.model_uuid);if(-1!=b)this.modelEntityArray[b]=a;else{b=this.modelEntityArray.length;this.modelEntityArray.push(a);var c=this.modelsTable.insertRow(-1);this.trs[b]=c;var d=this.util.insertCellWithClass(c,"cellWithBorder"),e=document.createElement("input");this.checkboxes[b]=e;e.setAttribute("type","checkbox");e.onclick=this.checkbox_onclick.bind(this);d.appendChild(e);this.util.insertCellWithClass(c,"cellWithBorder").textContent=
(new Date(a.create_time_ms)).toLocaleString();d=this.util.insertCellWithClass(c,"cellWithBorder");e=document.createElement("a");var f="monitorTraining?model_uuid="+encodeURIComponent(a.model_uuid),g=document.createTextNode(a.description);e.setAttribute("href",f);e.appendChild(g);d.appendChild(e);this.util.insertCellWithClass(c,"cellWithBorder").textContent=a.original_starting_model;d=this.util.insertCellWithClass(c,"cellWithBorder");d.setAttribute("align","right");d.textContent=(new Number(a.num_training_steps)).toLocaleString();
this.trainStateTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.trainedStepsTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.trainedStepsTds[b].setAttribute("align","right");this.trainTimeTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.trainTimeTds[b].setAttribute("align","right");1==this.modelEntityArray.length&&(this.modelsListDiv.style.display="block")}this.trainStateTds[b].textContent=this.util.formatJobState(a.cancel_requested,a.train_job_state);this.trainedStepsTds[b].textContent=
(new Number(a.trained_steps)).toLocaleString();0<a.train_job_elapsed_seconds&&(this.trainTimeTds[b].textContent=this.util.formatElapsedSeconds(a.train_job_elapsed_seconds));this.util.isTrainingDone(a)?(this.trs[b].className="trainingDone",this.trainingDone[b]=!0,this.clearTrainTimeIntervalIfNecessary()):(this.trs[b].className="trainingNotDone",this.trainingDone[b]=!1,b=this.util.isStateChangingSoon(a.cancel_requested,a.train_job_state)||this.util.isStateChangingSoon(a.cancel_requested,a.eval_job_state)?
1E4:6E4,setTimeout(this.retrieveModelEntity.bind(this,a.model_uuid),b),this.trainTimeIntervalId||(this.trainTimeIntervalId=setInterval(this.updateTrainTime.bind(this),500)));this.updateButtons()};fmltc.ListModels.prototype.updateTrainTime=function(){for(var a=0;a<this.trainingDone.length;a++)!this.trainingDone[a]&&this.modelEntityArray[a]&&0==this.modelEntityArray[a].train_job_elapsed_seconds&&"train_job_start_time"in this.modelEntityArray[a]&&(this.trainTimeTds[a].textContent=this.util.formatElapsedSeconds(this.util.calculateSecondsSince(this.modelEntityArray[a].train_job_start_time)))};
fmltc.ListModels.prototype.clearTrainTimeIntervalIfNecessary=function(){if(this.trainTimeIntervalId){for(var a=!0,b=0;b<this.trainingDone.length;b++)if(!this.trainingDone[b]){a=!1;break}a&&(clearInterval(this.trainTimeIntervalId),this.trainTimeIntervalId=0)}};
fmltc.ListModels.prototype.retrieveModelEntity=function(a){if(-1!=this.indexOfModel(a)){var b=new XMLHttpRequest,c="model_uuid="+encodeURIComponent(a);b.open("POST","/retrieveModelEntity",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_retrieveModelEntity_onreadystatechange.bind(this,b,c,a);b.send(c)}};
fmltc.ListModels.prototype.xhr_retrieveModelEntity_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,-1!=this.indexOfModel(c)&&(200===a.status?(a=JSON.parse(a.responseText),this.remainingTrainingMinutes=Math.floor(a.remaining_training_minutes),this.onModelEntityUpdated(a.model_entity)):(console.log("Failure! /retrieveModelEntity?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),console.log("Will retry /retrieveModelEntity?"+b+" in 1 second."),setTimeout(this.retrieveModelEntity.bind(this,
c),1E3))))};fmltc.ListModels.prototype.addNewModel=function(a,b){this.remainingTrainingMinutes=a;this.onModelEntityUpdated(b)};fmltc.ListModels.prototype.modelCheckboxAll_onclick=function(){this.util.checkAllOrNone(this.modelCheckboxAll,this.checkboxes);this.updateButtons()};fmltc.ListModels.prototype.checkbox_onclick=function(){this.updateButtons()};
fmltc.ListModels.prototype.cancelTrainingButton_onclick=function(){for(var a=this.getCheckedModelUuids(),b=0;b<a.length;b++){var c=a[b],d=this.indexOfModel(c);-1!=d&&(this.util.isTrainingDone(this.modelEntityArray[d])||this.cancelTraining(c))}};
fmltc.ListModels.prototype.cancelTraining=function(a){var b=new XMLHttpRequest,c="model_uuid="+encodeURIComponent(a);b.open("POST","/cancelTrainingModel",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_cancelTraining_onreadystatechange.bind(this,b,c,a);b.send(c)};
fmltc.ListModels.prototype.xhr_cancelTraining_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText).model_entity,this.onModelEntityUpdated(a)):console.log("Failure! /cancelTraining?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};
fmltc.ListModels.prototype.deleteModelsButton_onclick=function(){var a=this.getCheckedModelUuids(),b=JSON.stringify(a),c=new XMLHttpRequest;b="model_uuids="+encodeURIComponent(b);c.open("POST","/canDeleteModels",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_canDeleteModels_onreadystatechange.bind(this,c,b,a);c.send(b)};
fmltc.ListModels.prototype.xhr_canDeleteModels_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),a.can_delete_models?new fmltc.DeleteConfirmationDialog(this.util,"Delete Models","Are you sure you want to delete the selected models?",this.deleteModels.bind(this,c)):new fmltc.DeleteForbiddenDialog(this.util,"Delete Models","The selected models cannot be deleted.",a.messages)):console.log("Failure! /canDeleteModels?"+b+" xhr.status is "+
a.status+". xhr.statusText is "+a.statusText))};fmltc.ListModels.prototype.deleteModels=function(a){this.waitCursor=!0;this.util.setWaitCursor();this.updateButtons();for(var b=this.deleteModelCounter=0;b<a.length;b++){var c=a[b],d=this.indexOfModel(c);-1!=d&&this.util.isTrainingDone(this.modelEntityArray[d])&&(this.deleteModel(c),this.deleteModelCounter++)}};
fmltc.ListModels.prototype.deleteModel=function(a){var b=new XMLHttpRequest,c="model_uuid="+encodeURIComponent(a);b.open("POST","/deleteModel",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_deleteModel_onreadystatechange.bind(this,b,c,a);b.send(c)};
fmltc.ListModels.prototype.xhr_deleteModel_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,this.deleteModelCounter--,0==this.deleteModelCounter&&(this.util.clearWaitCursor(),this.waitCursor=!1),200===a.status?(a=this.indexOfModel(c),-1!=a&&(this.modelsTable.deleteRow(a+this.headerRowCount),this.modelEntityArray.splice(a,1),this.trs.splice(a,1),this.checkboxes[a].onclick=null,this.checkboxes.splice(a,1),this.trainStateTds.splice(a,1),this.trainedStepsTds.splice(a,1),
this.trainTimeTds.splice(a,1),this.updateButtons(),0==this.modelEntityArray.length&&(this.modelsListDiv.style.display="none"))):console.log("Failure! /deleteModel?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};fmltc.ListModels.prototype.indexOfModel=function(a){for(var b=0;b<this.modelEntityArray.length;b++)if(this.modelEntityArray[b].model_uuid==a)return b;return-1};
fmltc.ListModels.prototype.updateButtons=function(){for(var a=this.util.countChecked(this.checkboxes),b=!0,c=!0,d=!0,e=!0,f=0;f<this.checkboxes.length;f++)this.checkboxes[f].checked&&(this.util.isTrainingDone(this.modelEntityArray[f])?(d=!1,""==this.modelEntityArray[f].trained_checkpoint_path&&(c=b=!1)):(e=c=b=!1,this.modelEntityArray[f].cancel_requested&&(d=!1)));this.trainMoreButton.disabled=this.waitCursor||1!=a||!b;this.downloadTFLiteButton.disabled=this.waitCursor||1!=a||!c;this.cancelTrainingButton.disabled=
this.waitCursor||1!=a||!d;this.deleteModelsButton.disabled=this.waitCursor||0==a||!e};fmltc.ListModels.prototype.getCheckedModelUuids=function(){for(var a=[],b=0;b<this.checkboxes.length;b++)this.checkboxes[b].checked&&a.push(this.modelEntityArray[b].model_uuid);return a};fmltc.ListModels.prototype.getCheckedModelEntities=function(){for(var a=[],b=0;b<this.checkboxes.length;b++)this.checkboxes[b].checked&&a.push(this.modelEntityArray[b]);return a};
fmltc.ListModels.prototype.trainMoreButton_onclick=function(){var a=this.getCheckedModelEntities()[0],b=this.util.getListDatasets().getDatasetsWithLabels(a.sorted_label_list);new fmltc.TrainMoreDialog(this.util,this.totalTrainingMinutes,this.remainingTrainingMinutes,a,b,this.onTrainingStarted.bind(this))};fmltc.ListModels.prototype.onTrainingStarted=function(a,b){this.addNewModel(a,b)};
fmltc.ListModels.prototype.downloadTFLiteButton_onclick=function(){this.util.setWaitCursor();this.waitCursor=!0;this.updateButtons();var a=this.getCheckedModelUuids()[0],b=Date.now();this.createTFLiteGraphPb(a,b)};
fmltc.ListModels.prototype.createTFLiteGraphPb=function(a,b){var c=new XMLHttpRequest,d="model_uuid="+encodeURIComponent(a);c.open("POST","/createTFLiteGraphPb",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_createTFLiteGraphPb_onreadystatechange.bind(this,c,d,a,b);c.send(d)};
fmltc.ListModels.prototype.xhr_createTFLiteGraphPb_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,200===a.status?this.createTFLite(c,d):(console.log("Failure! /createTFLiteGraphPb?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),this.util.clearWaitCursor(),this.waitCursor=!1,this.updateButtons()))};
fmltc.ListModels.prototype.createTFLite=function(a,b){var c=new XMLHttpRequest,d="model_uuid="+encodeURIComponent(a);c.open("POST","/createTFLite",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_createTFLite_onreadystatechange.bind(this,c,d,a,b);c.send(d)};
fmltc.ListModels.prototype.xhr_createTFLite_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),this.downloadTFLite(d,a.download_url,0)):(console.log("Failure! /createTFLite?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),this.util.clearWaitCursor(),this.waitCursor=!1,this.updateButtons()))};
fmltc.ListModels.prototype.downloadTFLite=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",b,!0);d.responseType="blob";d.onreadystatechange=this.xhr_downloadTFLite_onreadystatechange.bind(this,d,a,b,c);d.send(null)};
fmltc.ListModels.prototype.xhr_downloadTFLite_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,this.util.clearWaitCursor(),this.waitCursor=!1,this.updateButtons(),200===a.status?(c=document.createElement("a"),c.href=window.URL.createObjectURL(a.response),c.download="model_"+this.util.getDateTimeString(b)+".tflite",c.click()):(d++,5>d?(a=Math.pow(2,d),console.log("Will retry "+c+" in "+a+" seconds."),setTimeout(this.downloadTFLite.bind(this,b,c,d),1E3*a)):alert("Unable to download the TFLite model.")))};fmltc.ProduceDatasetDialog=function(a,b,c,d){this.util=a;this.videoUuids=b;this.totalFrameCount=c;this.onDatasetProduced=d;this.dialog=document.getElementById("produceDatasetDialog");this.dismissButton=document.getElementById("pdDismissButton");this.descriptionInput=document.getElementById("pdDescriptionInput");this.trainPercentInput=document.getElementById("pdTrainPercentInput");this.evalPercentInput=document.getElementById("pdEvalPercentInput");this.startButton=document.getElementById("pdStartButton");
this.progressDiv=document.getElementById("pdProgressDiv");this.progress=document.getElementById("pdProgress");this.progressSpan=document.getElementById("pdProgressSpan");this.finishedDiv=document.getElementById("pdFinishedDiv");this.failedDiv=document.getElementById("pdFailedDiv");this.startDatasetInProgress=!1;this.dismissButton.disabled=!1;this.descriptionInput.disabled=!1;this.trainPercentInput.disabled=!1;this.evalPercentInput.disabled=!1;this.trainPercentInput.value=100>.2*c?80:100>.1*c?90:Math.min(99,
Math.ceil(100-1E4/c));this.evalPercentInput.value=100-this.trainPercentInput.value;this.descriptionInput.value="";this.progressStartValue=.1*this.totalFrameCount;this.progressMaxValue=this.totalFrameCount+this.progressStartValue;this.updateStartButton();this.progressDiv.style.visibility="hidden";this.finishedDiv.style.display="none";this.failedDiv.style.display="none";this.dismissButton.onclick=this.dismissButton_onclick.bind(this);this.trainPercentInput.onchange=this.trainPercentInput_onchange.bind(this);
this.evalPercentInput.onchange=this.evalPercentInput_onchange.bind(this);this.descriptionInput.oninput=this.descriptionInput_oninput.bind(this);this.startButton.onclick=this.startButton_onclick.bind(this);this.dialog.style.display="block"};
fmltc.ProduceDatasetDialog.prototype.dismissButton_onclick=function(){this.dismissButton.onclick=null;this.descriptionInput.oninput=null;this.trainPercentInput.onchange=null;this.evalPercentInput.onchange=null;this.startButton.onclick=null;this.dialog.style.display="none"};fmltc.ProduceDatasetDialog.prototype.descriptionInput_oninput=function(){this.updateStartButton()};
fmltc.ProduceDatasetDialog.prototype.updateStartButton=function(){this.startButton.disabled=this.startDatasetInProgress||0>this.evalPercentInput.value||100<this.evalPercentInput.value||0==this.descriptionInput.value.length};fmltc.ProduceDatasetDialog.prototype.trainPercentInput_onchange=function(){this.evalPercentInput.value=100-this.trainPercentInput.value;this.updateStartButton()};
fmltc.ProduceDatasetDialog.prototype.evalPercentInput_onchange=function(){this.trainPercentInput.value=100-this.evalPercentInput.value;this.updateStartButton()};
fmltc.ProduceDatasetDialog.prototype.startButton_onclick=function(){this.dismissButton.disabled=!0;this.descriptionInput.disabled=!0;this.trainPercentInput.disabled=!0;this.evalPercentInput.disabled=!0;this.progress.value=this.progressStartValue;this.progress.max=this.progressMaxValue;this.progressSpan.textContent=this.makeProgressLabel(0);this.progressDiv.style.visibility="visible";this.startDatasetInProgress=!0;this.updateStartButton();var a=JSON.stringify(this.videoUuids),b=new XMLHttpRequest;
a="description="+encodeURIComponent(this.descriptionInput.value)+"&video_uuids="+encodeURIComponent(a)+"&eval_percent="+this.evalPercentInput.value+"&create_time_ms="+Date.now();b.open("POST","/prepareToStartDatasetProduction",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_prepareToStartDatasetProduction_onreadystatechange.bind(this,b,a);b.send(a)};
fmltc.ProduceDatasetDialog.prototype.makeProgressLabel=function(a){return" Video frames processed: "+a+" of "+this.totalFrameCount};
fmltc.ProduceDatasetDialog.prototype.xhr_prepareToStartDatasetProduction_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),setTimeout(this.retrieveDatasetEntity.bind(this,a.dataset_uuid),1E3)):(console.log("Failure! /prepareToStartDatasetProduction?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),this.startDatasetInProgress=!1,this.updateStartButton(),this.progressDiv.style.visibility="hidden",this.failedDiv.style.display=
"block"))};fmltc.ProduceDatasetDialog.prototype.retrieveDatasetEntity=function(a){var b=new XMLHttpRequest,c="dataset_uuid="+encodeURIComponent(a);b.open("POST","/retrieveDatasetEntity",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_retrieveDatasetEntity_onreadystatechange.bind(this,b,c,a);b.send(c)};
fmltc.ProduceDatasetDialog.prototype.xhr_retrieveDatasetEntity_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),b=a.dataset_entity,b.dataset_completed?(this.startDatasetInProgress=!1,this.startButton.onclick=null,this.updateStartButton(),this.progress.value=this.progress.max,this.progressDiv.style.visibility="hidden",this.finishedDiv.style.display="block",this.dismissButton.disabled=!1,this.descriptionInput.disabled=!1,this.trainPercentInput.disabled=
!1,this.evalPercentInput.disabled=!1,this.onDatasetProduced(b),setTimeout(this.dismissButton_onclick.bind(this),1E3)):(this.progress.value=this.progressStartValue+a.frames_written,this.progressSpan.textContent=this.makeProgressLabel(a.frames_written),setTimeout(this.retrieveDatasetEntity.bind(this,c),2E3))):(console.log("Failure! /retrieveDatasetEntity?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),console.log("Will retry /retrieveDatasetEntity?"+b+" in 5 seconds."),setTimeout(this.retrieveDatasetEntity.bind(this,
c),5E3)))};fmltc.ListVideos=function(a){this.util=a;this.videosListDiv=document.getElementById("videosListDiv");this.videosTable=document.getElementById("videosTable");this.videoCheckboxAll=document.getElementById("videoCheckboxAll");this.produceDatasetButton=document.getElementById("produceDatasetButton");this.deleteVideosButton=document.getElementById("deleteVideosButton");this.headerRowCount=this.videosTable.rows.length;this.videoEntityArray=[];this.frameExtractionComplete=[];this.trs=[];this.checkboxes=
[];this.descriptionTds=[];this.dimensionsTds=[];this.durationTds=[];this.framesPerSecondTds=[];this.frameCountTds=[];this.extractedFrameCountTds=[];this.labeledFrameCountTds=[];this.excludedFrameCountTds=[];this.waitCursor=!1;this.deleteVideoCounter=0;this.retrieveVideoEntities();this.updateButtons();document.getElementById("uploadVideoFileButton").onclick=this.uploadVideoFileButton_onclick.bind(this);this.videoCheckboxAll.onclick=this.videoCheckboxAll_onclick.bind(this);this.produceDatasetButton.onclick=
this.produceDatasetButton_onclick.bind(this);this.deleteVideosButton.onclick=this.deleteVideosButton_onclick.bind(this)};fmltc.ListVideos.prototype.retrieveVideoEntities=function(){var a=new XMLHttpRequest;a.open("POST","/retrieveVideoEntities",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_retrieveVideoEntities_onreadystatechange.bind(this,a);a.send()};
fmltc.ListVideos.prototype.xhr_retrieveVideoEntities_onreadystatechange=function(a){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){a=JSON.parse(a.responseText).video_entities;for(var b=0;b<a.length;b++)this.onVideoEntityUpdated(a[b]);document.getElementById("videosLoader").style.visibility="hidden"}else console.log("Failure! /retrieveVideoEntities? xhr.status is "+a.status+". xhr.statusText is "+a.statusText)};
fmltc.ListVideos.prototype.onVideoEntityUpdated=function(a){var b=this.indexOfVideo(a.video_uuid);if(-1!=b)this.videoEntityArray[b]=a;else{b=this.videoEntityArray.length;this.videoEntityArray.push(a);this.frameExtractionComplete[b]=!1;var c=this.videosTable.insertRow(-1);this.trs[b]=c;var d=this.util.insertCellWithClass(c,"cellWithBorder"),e=document.createElement("input");this.checkboxes[b]=e;e.setAttribute("type","checkbox");e.onclick=this.checkbox_onclick.bind(this);d.appendChild(e);this.util.insertCellWithClass(c,
"cellWithBorder").textContent=(new Date(a.create_time_ms)).toLocaleString();d=this.util.insertCellWithClass(c,"cellWithBorder");this.descriptionTds[b]=d;d.appendChild(document.createTextNode(a.description));this.util.insertCellWithClass(c,"cellWithBorder").appendChild(document.createTextNode(a.video_filename));d=this.util.insertCellWithClass(c,"cellWithBorder");d.setAttribute("align","right");d.textContent=(new Number(a.file_size)).toLocaleString();this.dimensionsTds[b]=this.util.insertCellWithClass(c,
"cellWithBorder");this.durationTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.durationTds[b].setAttribute("align","right");this.framesPerSecondTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.framesPerSecondTds[b].setAttribute("align","right");this.frameCountTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.frameCountTds[b].setAttribute("align","right");this.extractedFrameCountTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.extractedFrameCountTds[b].setAttribute("align",
"right");this.labeledFrameCountTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.labeledFrameCountTds[b].setAttribute("align","right");this.excludedFrameCountTds[b]=this.util.insertCellWithClass(c,"cellWithBorder");this.excludedFrameCountTds[b].setAttribute("align","right");1==this.videoEntityArray.length&&(this.videosListDiv.style.display="block")}c=!0;"width"in a&&"height"in a?this.dimensionsTds[b].textContent=a.width+" x "+a.height:c=!1;"frame_count"in a&&"fps"in a?this.durationTds[b].textContent=
this.util.formatElapsedSeconds(a.frame_count/a.fps):c=!1;"fps"in a?this.framesPerSecondTds[b].textContent=a.fps.toFixed(0):c=!1;"frame_count"in a?(this.frameCountTds[b].textContent=a.frame_count,a.extracted_frame_count!=a.frame_count&&(c=!1)):c=!1;this.extractedFrameCountTds[b].textContent=a.extracted_frame_count;this.labeledFrameCountTds[b].textContent=a.labeled_frame_count;this.excludedFrameCountTds[b].textContent=a.extracted_frame_count-a.included_frame_count;c?(this.frameExtractionComplete[b]=
!0,this.trs[b].className="frameExtractionComplete",c=this.descriptionTds[b].childNodes[0],"A"!=c.nodeName&&(d=document.createElement("a"),e="labelVideo?video_uuid="+encodeURIComponent(a.video_uuid),d.setAttribute("href",e),d.appendChild(document.createTextNode(a.description)),this.descriptionTds[b].replaceChild(d,c))):this.didFrameExtractionFailToStart(a)?this.startFrameExtraction(a.video_uuid):this.isFrameExtractionStalled(a)?this.startFrameExtraction(a.video_uuid):(this.trs[b].className="frameExtractionIncomplete",
setTimeout(this.retrieveVideoEntity.bind(this,a.video_uuid,!0),1E4))};fmltc.ListVideos.prototype.didFrameExtractionFailToStart=function(a){return 0!=a.frame_extraction_triggered_time_utc_ms&&0==a.frame_extraction_active_time_utc_ms&&3<(Date.now()-a.frame_extraction_triggered_time_utc_ms)/6E4?!0:!1};fmltc.ListVideos.prototype.isFrameExtractionStalled=function(a){return 0!=a.frame_extraction_active_time_utc_ms&&3<(Date.now()-a.frame_extraction_active_time_utc_ms)/6E4?!0:!1};
fmltc.ListVideos.prototype.retrieveVideoEntity=function(a,b){if(!b||-1!=this.indexOfVideo(a)){var c=new XMLHttpRequest,d="video_uuid="+encodeURIComponent(a);c.open("POST","/retrieveVideoEntity",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_retrieveVideoEntity_onreadystatechange.bind(this,c,d,a,b);c.send(d)}};
fmltc.ListVideos.prototype.xhr_retrieveVideoEntity_onreadystatechange=function(a,b,c,d){4===a.readyState&&(a.onreadystatechange=null,d&&-1==this.indexOfVideo(c)||(200===a.status?(a=JSON.parse(a.responseText).video_entity,this.onVideoEntityUpdated(a)):(console.log("Failure! /retrieveVideoEntity?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),console.log("Will retry /retrieveVideoEntity?"+b+" in 3 seconds."),setTimeout(this.retrieveVideoEntity.bind(this,c,d),3E3))))};
fmltc.ListVideos.prototype.uploadVideoFileButton_onclick=function(){new fmltc.UploadVideoFileDialog(this.util,this.onVideoUploaded.bind(this))};fmltc.ListVideos.prototype.onVideoUploaded=function(a){this.retrieveVideoEntity(a,!1)};fmltc.ListVideos.prototype.videoCheckboxAll_onclick=function(){this.util.checkAllOrNone(this.videoCheckboxAll,this.checkboxes);this.updateButtons()};fmltc.ListVideos.prototype.checkbox_onclick=function(){this.updateButtons()};
fmltc.ListVideos.prototype.updateButtons=function(){for(var a=this.util.countChecked(this.checkboxes),b=!1,c=0;c<this.checkboxes.length;c++)this.checkboxes[c].checked&&(this.frameExtractionComplete[c]||(b=!0));this.produceDatasetButton.disabled=this.waitCursor||0==a||b;this.deleteVideosButton.disabled=this.waitCursor||0==a||b};
fmltc.ListVideos.prototype.deleteVideosButton_onclick=function(){var a=this.getCheckedVideoUuids(),b=JSON.stringify(a),c=new XMLHttpRequest;b="video_uuids="+encodeURIComponent(b);c.open("POST","/canDeleteVideos",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_canDeleteVideos_onreadystatechange.bind(this,c,b,a);c.send(b)};
fmltc.ListVideos.prototype.xhr_canDeleteVideos_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),a.can_delete_videos?new fmltc.DeleteConfirmationDialog(this.util,"Delete Videos","Are you sure you want to delete the selected videos?",this.deleteVideos.bind(this,c)):new fmltc.DeleteForbiddenDialog(this.util,"Delete Videos","The selected videos cannot be deleted.",a.messages)):console.log("Failure! /canDeleteVideos?"+b+" xhr.status is "+
a.status+". xhr.statusText is "+a.statusText))};fmltc.ListVideos.prototype.deleteVideos=function(a){this.waitCursor=!0;this.util.setWaitCursor();this.updateButtons();for(var b=this.deleteVideoCounter=0;b<a.length;b++){var c=a[b],d=new XMLHttpRequest,e="video_uuid="+encodeURIComponent(c);d.open("POST","/deleteVideo",!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=this.xhr_deleteVideo_onreadystatechange.bind(this,d,e,c);d.send(e);this.deleteVideoCounter++}};
fmltc.ListVideos.prototype.xhr_deleteVideo_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,this.deleteVideoCounter--,0==this.deleteVideoCounter&&(this.util.clearWaitCursor(),this.waitCursor=!1,this.updateButtons()),200===a.status?(a=this.indexOfVideo(c),-1!=a&&(this.videosTable.deleteRow(a+this.headerRowCount),this.videoEntityArray.splice(a,1),this.frameExtractionComplete.splice(a,1),this.trs.splice(a,1),this.checkboxes[a].onclick=null,this.checkboxes.splice(a,1),this.descriptionTds.splice(a,
1),this.dimensionsTds.splice(a,1),this.durationTds.splice(a,1),this.framesPerSecondTds.splice(a,1),this.frameCountTds.splice(a,1),this.extractedFrameCountTds.splice(a,1),this.labeledFrameCountTds.splice(a,1),this.excludedFrameCountTds.splice(a,1),0==this.videoEntityArray.length&&(this.videosListDiv.style.display="none"))):console.log("Failure! /deleteVideo?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};
fmltc.ListVideos.prototype.startFrameExtraction=function(a){if(-1!=this.indexOfVideo(a)){var b=new XMLHttpRequest,c="video_uuid="+encodeURIComponent(a);b.open("POST","/startFrameExtraction",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_triggerFrameExtraction_onreadystatechange.bind(this,b,c,a);b.send(c)}};
fmltc.ListVideos.prototype.xhr_triggerFrameExtraction_onreadystatechange=function(a,b,c){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=this.indexOfVideo(c),-1!=a&&(this.trs[a].className="frameExtractionIncomplete"),setTimeout(this.retrieveVideoEntity.bind(this,c,!0),1E3)):console.log("Failure! /startFrameExtraction?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};
fmltc.ListVideos.prototype.indexOfVideo=function(a){for(var b=0;b<this.videoEntityArray.length;b++)if(this.videoEntityArray[b].video_uuid==a)return b;return-1};fmltc.ListVideos.prototype.getCheckedVideoUuids=function(){for(var a=[],b=0;b<this.checkboxes.length;b++)this.checkboxes[b].checked&&a.push(this.videoEntityArray[b].video_uuid);return a};
fmltc.ListVideos.prototype.produceDatasetButton_onclick=function(){for(var a=[],b=0,c=0;c<this.checkboxes.length;c++)this.checkboxes[c].checked&&(a.push(this.videoEntityArray[c].video_uuid),b+=this.videoEntityArray[c].included_frame_count);new fmltc.ProduceDatasetDialog(this.util,a,b,this.onDatasetProduced.bind(this))};fmltc.ListVideos.prototype.onDatasetProduced=function(a){this.util.getListDatasets().addNewDataset(a);this.util.showDatasetsTab()};fmltc.MonitorTraining=function(a,b,c,d){this.util=a;this.modelUuid=b;this.modelEntity=c[b];this.modelEntitiesByUuid=c;this.datasetEntitiesByUuid=d;this.activeTrainingDiv=document.getElementById("activeTrainingDiv");this.cancelTrainingButton=document.getElementById("cancelTrainingButton");this.refreshIntervalRangeInput=document.getElementById("refreshIntervalRangeInput");this.refreshButton=document.getElementById("refreshButton");this.trainTimeTd=document.getElementById("trainTimeTd");this.trainingScalarsDiv=
document.getElementById("trainingScalarsDiv");this.trainingScalarsHeading=document.getElementById("trainingScalarsHeading");this.evalScalarsDiv=document.getElementById("evalScalarsDiv");this.evalScalarsHeading=document.getElementById("evalScalarsHeading");this.firstPageButton=document.getElementById("firstPageButton");this.previousPageButton=document.getElementById("previousPageButton");this.nextPageButton=document.getElementById("nextPageButton");this.lastPageButton=document.getElementById("lastPageButton");
this.currentPageSpan=document.getElementById("currentPageSpan");this.evalImagesDiv=document.getElementById("evalImagesDiv");this.modelLoader=document.getElementById("modelLoader");this.scalarsLoader=document.getElementById("scalarsLoader");this.imagesLoader=document.getElementById("imagesLoader");this.trainTimeIntervalId=0;this.filledModelUI=this.chartsLoaded=!1;this.evalUpdated=this.trainingUpdated="";this.retrieveDataStartTimeMs=0;this.retrieveDataInProgressCounters={};this.retrieveDataInProgressCounters.scalar=
0;this.retrieveDataInProgressCounters.image=0;this.loaders={};this.loaders.scalar=this.scalarsLoader;this.loaders.image=this.imagesLoader;this.trainingScalars={};this.trainingScalars.job_type="train";this.trainingScalars.valueType="scalar";this.trainingScalars.maxItemsPerRequest=50;this.trainingScalars.scalarsHeading=this.trainingScalarsHeading;this.trainingScalars.parentDiv=this.trainingScalarsDiv;this.trainingScalars.mapTagToSteps={};this.trainingScalars.sortedTags=[];this.trainingScalars.mapTagToDiv=
{};this.trainingScalars.mapTagToLineChart={};this.trainingScalars.mapTagToDataTable={};this.trainingScalars.items={};this.evalScalars={};this.evalScalars.job_type="eval";this.evalScalars.valueType="scalar";this.evalScalars.maxItemsPerRequest=50;this.evalScalars.scalarsHeading=this.evalScalarsHeading;this.evalScalars.parentDiv=this.evalScalarsDiv;this.evalScalars.mapTagToSteps={};this.evalScalars.sortedTags=[];this.evalScalars.mapTagToDiv={};this.evalScalars.mapTagToLineChart={};this.evalScalars.mapTagToDataTable=
{};this.evalScalars.items={};this.evalImages={};this.evalImages.job_type="eval";this.evalImages.valueType="image";this.evalImages.maxItemsPerRequest=20;this.evalImages.parentDiv=this.evalImagesDiv;this.evalImages.mapTagToSteps={};this.evalImages.sortedTags=[];this.evalImages.currentPageIndex=0;this.evalImages.pageDivs=[];this.evalImages.mapTagToDiv={};this.evalImages.mapTagToStepLabelDiv={};this.evalImages.mapTagToImgs={};this.evalImages.mapTagToStepsNotRequestedYet={};this.evalImages.items={};document.getElementById("descriptionSpan").textContent=
this.modelEntity.description;this.refreshStartTimeMs=this.refreshTimeoutId=0;this.setRefreshIntervalRangeInputTitle();this.updateButtons();this.updateModelUI();this.retrieveData();google.charts.load("current",{packages:["corechart"]});google.charts.setOnLoadCallback(this.charts_onload.bind(this));this.tab_onresize(document.getElementById("imagesTabDiv"));this.util.addTabResizeListener(this.tab_onresize.bind(this));this.util.addTabClickListener(this.tab_onclick.bind(this));document.getElementById("dismissButton").onclick=
this.dismissButton_onclick.bind(this);this.cancelTrainingButton.onclick=this.cancelTrainingButton_onclick.bind(this);this.refreshIntervalRangeInput.onchange=this.refreshIntervalRangeInput_onchange.bind(this);this.refreshButton.onclick=this.refreshButton_onclick.bind(this);this.firstPageButton.onclick=this.firstPageButton_onclick.bind(this);this.previousPageButton.onclick=this.previousPageButton_onclick.bind(this);this.nextPageButton.onclick=this.nextPageButton_onclick.bind(this);this.lastPageButton.onclick=
this.lastPageButton_onclick.bind(this)};fmltc.MonitorTraining.prototype.dismissButton_onclick=function(){window.history.back()};fmltc.MonitorTraining.prototype.updateButtons=function(){var a=!0;this.util.isTrainingDone(this.modelEntity)?a=!1:this.modelEntity.cancel_requested&&(a=!1);this.cancelTrainingButton.disabled=!a};
fmltc.MonitorTraining.prototype.cancelTrainingButton_onclick=function(){var a=new XMLHttpRequest,b="model_uuid="+encodeURIComponent(this.modelUuid);a.open("POST","/cancelTrainingModel",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_cancelTraining_onreadystatechange.bind(this,a,b);a.send(b)};
fmltc.MonitorTraining.prototype.xhr_cancelTraining_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),this.modelEntityUpdated(a.model_entity)):console.log("Failure! /cancelTraining?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText))};
fmltc.MonitorTraining.prototype.setRefreshIntervalRangeInputTitle=function(){this.refreshIntervalRangeInput.title=1==this.refreshIntervalRangeInput.value?this.refreshIntervalRangeInput.value+" minute":this.refreshIntervalRangeInput.value+" minutes"};fmltc.MonitorTraining.prototype.refreshIntervalRangeInput_onchange=function(){this.setRefreshIntervalRangeInputTitle();this.refreshTimeoutId&&(clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId=0,this.startRefreshTimer())};
fmltc.MonitorTraining.prototype.startRefreshTimer=function(){var a=Date.now()-this.refreshStartTimeMs;a=Math.max(1,6E4*this.refreshIntervalRangeInput.value-a);this.refreshTimeoutId=setTimeout(this.refreshTimeout.bind(this),a)};fmltc.MonitorTraining.prototype.refreshTimeout=function(){this.refreshTimeoutId=0;this.retrieveData()};fmltc.MonitorTraining.prototype.refreshButton_onclick=function(){this.refreshTimeoutId&&(clearInterval(this.refreshTimeoutId),this.refreshTimeoutId=0);this.retrieveData()};
fmltc.MonitorTraining.prototype.charts_onload=function(){this.chartsLoaded=!0};fmltc.MonitorTraining.prototype.retrieveData=function(){this.refreshStartTimeMs=Date.now();this.refreshButton.disabled=!0;this.retrieveSummariesUpdated(0)};
fmltc.MonitorTraining.prototype.incrementRetrieveDataInProgressCounter=function(a){0==this.retrieveDataInProgressCounters.scalar&&0==this.retrieveDataInProgressCounters.image&&this.retrieveDataStarting();0==this.retrieveDataInProgressCounters[a]&&(this.loaders[a].style.visibility="visible");this.retrieveDataInProgressCounters[a]++};fmltc.MonitorTraining.prototype.retrieveDataStarting=function(){this.retrieveDataStartTimeMs=Date.now()};
fmltc.MonitorTraining.prototype.decrementRetrieveDataInProgressCounter=function(a){this.retrieveDataInProgressCounters[a]--;0==this.retrieveDataInProgressCounters[a]&&(this.loaders[a].style.visibility="hidden");0==this.retrieveDataInProgressCounters.scalar&&0==this.retrieveDataInProgressCounters.image&&this.retrieveDataFinished()};fmltc.MonitorTraining.prototype.retrieveDataFinished=function(){this.util.isTrainingDone(this.modelEntity)||(this.startRefreshTimer(),this.refreshButton.disabled=!1)};
fmltc.MonitorTraining.prototype.retrieveSummariesUpdated=function(a){0==a&&(this.incrementRetrieveDataInProgressCounter("scalar"),this.incrementRetrieveDataInProgressCounter("image"));var b=new XMLHttpRequest,c="model_uuid="+encodeURIComponent(this.modelUuid);b.open("POST","/retrieveSummariesUpdated",!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=this.xhr_retrieveSummariesUpdated_onreadystatechange.bind(this,b,c,a);b.send(c)};
fmltc.MonitorTraining.prototype.xhr_retrieveSummariesUpdated_onreadystatechange=function(a,b,c){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){b=JSON.parse(a.responseText);this.modelEntityUpdated(b.model_entity);if(b.training_updated!=this.trainingUpdated||b.eval_updated!=this.evalUpdated)this.trainingUpdated=b.training_updated,this.evalUpdated=b.eval_updated,this.retrieveTagsAndSteps(this.evalImages,0),this.retrieveTagsAndSteps(this.trainingScalars,0),this.retrieveTagsAndSteps(this.evalScalars,
0);this.decrementRetrieveDataInProgressCounter("scalar");this.decrementRetrieveDataInProgressCounter("image")}else c++,5>c?(a=Math.pow(2,c),console.log("Will retry /retrieveSummariesUpdated?"+b+" in "+a+" seconds."),setTimeout(this.retrieveSummariesUpdated.bind(this,c),1E3*a)):(console.log("Unable to retrieve whether summaries have been updated."),this.decrementRetrieveDataInProgressCounter("scalar"),this.decrementRetrieveDataInProgressCounter("image"))};
fmltc.MonitorTraining.prototype.retrieveTagsAndSteps=function(a,b){0==b&&this.incrementRetrieveDataInProgressCounter(a.valueType);var c=new XMLHttpRequest,d="model_uuid="+encodeURIComponent(this.modelUuid)+"&job_type="+encodeURIComponent(a.job_type)+"&value_type="+encodeURIComponent(a.valueType);c.open("POST","/retrieveTagsAndSteps",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_retrieveTagsAndSteps_onreadystatechange.bind(this,c,Date.now(),
d,a,b);c.send(d)};
fmltc.MonitorTraining.prototype.xhr_retrieveTagsAndSteps_onreadystatechange=function(a,b,c,d,e){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){e=JSON.parse(a.responseText);c=[];for(a=0;a<e.step_and_tag_pairs.length;a++)b=e.step_and_tag_pairs[a],this.makeKey(b)in d.items||c.push(b);this.addToMapTagToSteps(c,d.mapTagToSteps);e={};this.addToMapTagToSteps(c,e);"scalar"==d.valueType?this.addCharts(d,e):this.addImages(d,e);e=[];if("image"==d.valueType)for(a=0;a<c.length;a++){b=c[a];var f=
b.tag;if(this.util.isDisplayed(d.mapTagToDiv[f],d.parentDiv))e.push(b);else{if(f in d.mapTagToStepsNotRequestedYet)var g=d.mapTagToStepsNotRequestedYet[f];else g=[],d.mapTagToStepsNotRequestedYet[f]=g;g.push(b.step)}}else for(a=0;a<c.length;a++)e.push(c[a]);this.retrieveSummaryItemsInParallel(d,e,2);this.decrementRetrieveDataInProgressCounter(d.valueType)}else e++,5>e?(a=Math.pow(2,e),console.log("Will retry /retrieveTagsAndSteps?"+c+" in "+a+" seconds."),setTimeout(this.retrieveTagsAndSteps.bind(this,
d,e),1E3*a)):(console.log("Unable to retrieve the tags and steps."),this.decrementRetrieveDataInProgressCounter(d.valueType))};fmltc.MonitorTraining.prototype.makeKey=function(a){return a.step+"_"+a.tag};fmltc.MonitorTraining.prototype.addToMapTagToSteps=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.step;d=d.tag;if(d in b)var f=b[d];else f=[],b[d]=f;f.push(e)}for(var g in b)b[g].sort(this.util.compare.bind(this.util))};
fmltc.MonitorTraining.prototype.retrieveSummaryItemsInParallel=function(a,b,c){for(var d=b.slice(c*a.maxItemsPerRequest),e=0;e<c;e++){var f=b.slice(a.maxItemsPerRequest*e,a.maxItemsPerRequest*(e+1));0<f.length&&(this.retrieveSummaryItems(a,f,d,0),d=[])}};
fmltc.MonitorTraining.prototype.retrieveSummaryItems=function(a,b,c,d){0==d&&this.incrementRetrieveDataInProgressCounter(a.valueType);for(var e=new XMLHttpRequest,f="model_uuid="+encodeURIComponent(this.modelUuid)+"&job_type="+encodeURIComponent(a.job_type)+"&value_type="+encodeURIComponent(a.valueType),g=0;g<b.length;g++)f+="&step"+g+"="+b[g].step+"&tag"+g+"="+b[g].tag;e.open("POST","/retrieveSummaryItems",!0);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.onreadystatechange=
this.xhr_retrieveSummaryItems_onreadystatechange.bind(this,e,Date.now(),f,a,b,c,d);e.send(f)};
fmltc.MonitorTraining.prototype.xhr_retrieveSummaryItems_onreadystatechange=function(a,b,c,d,e,f,g){if(4===a.readyState)if(a.onreadystatechange=null,200===a.status){c=JSON.parse(a.responseText);for(e=0;e<c.summary_items.length;e++)g=c.summary_items[e],a=this.makeKey(g),d.items[a]=g;if("scalar"==d.valueType)for(e=0;e<c.summary_items.length;e++)g=c.summary_items[e],this.addScalarValue(d,g.tag,g.step,g.value);else for(g=e=0;g<c.summary_items.length;g++)a=c.summary_items[g],this.addImageValue(d,a.tag,
a.step,a.value,e),e+=10;0<f.length&&this.retrieveSummaryItemsInParallel(d,f,2);this.decrementRetrieveDataInProgressCounter(d.valueType)}else g++,5>g?(a=Math.pow(2,g),console.log("Will retry /retrieveSummaryItems?"+c+" in "+a+" seconds."),setTimeout(this.retrieveSummaryItems.bind(this,d,e,f,g),1E3*a)):(console.log("Unable to retrieve the summary values."),this.decrementRetrieveDataInProgressCounter(d.valueType))};
fmltc.MonitorTraining.prototype.modelEntityUpdated=function(a){this.modelEntity=a;this.updateButtons();this.updateModelUI();this.activeTrainingDiv.style.display=this.util.isTrainingDone(this.modelEntity)?"none":"inline-block"};
fmltc.MonitorTraining.prototype.updateModelUI=function(){if(!this.filledModelUI){document.getElementById("dateCreatedTd").textContent=(new Date(this.modelEntity.create_time_ms)).toLocaleString();document.getElementById("originalModelTd").textContent=this.modelEntity.original_starting_model;var a=this.modelEntity.dataset_uuids.slice();if(this.modelEntity.original_starting_model!=this.modelEntity.starting_model){document.getElementById("previousModelTd").textContent=this.modelEntity.user_visible_starting_model;
var b=this.modelEntitiesByUuid[this.modelEntity.starting_model];document.getElementById("previousTrainingStepsTd").textContent=(new Number(b.total_training_steps)).toLocaleString();a=a.filter(function(a){return!b.dataset_uuids.includes(a)});for(var c=document.getElementById("previousDatasetsTd"),d=0;d<b.dataset_uuids.length;d++){var e=this.datasetEntitiesByUuid[b.dataset_uuids[d]],f=document.createElement("div");f.textContent=e.description;c.appendChild(f)}}else this.util.deleteRowById("previousModelTr"),
this.util.deleteRowById("previousTrainingStepsTr"),this.util.deleteRowById("previousDatasetsTr");c=document.getElementById("addedDatasetsTd");for(d=0;d<a.length;d++)e=this.datasetEntitiesByUuid[a[d]],f=document.createElement("div"),f.textContent=e.description,c.appendChild(f);document.getElementById("trainFrameCountTd").textContent=(new Number(this.modelEntity.train_frame_count)).toLocaleString();document.getElementById("trainNegativeFrameCountTd").textContent=(new Number(this.modelEntity.train_negative_frame_count)).toLocaleString();
a=document.getElementById("trainLabelCountsTable");for(var g in this.modelEntity.train_dict_label_to_count)c=a.insertRow(-1),d=c.insertCell(-1),d.textContent=g,d=c.insertCell(-1),d.textContent=(new Number(this.modelEntity.train_dict_label_to_count[g])).toLocaleString();document.getElementById("numTrainingStepsTd").textContent=(new Number(this.modelEntity.num_training_steps)).toLocaleString();document.getElementById("evalFrameCountTd").textContent=(new Number(this.modelEntity.eval_frame_count)).toLocaleString();
document.getElementById("evalNegativeFrameCountTd").textContent=(new Number(this.modelEntity.eval_negative_frame_count)).toLocaleString();g=document.getElementById("evalLabelCountsTable");for(var k in this.modelEntity.eval_dict_label_to_count)a=g.insertRow(-1),c=a.insertCell(-1),c.textContent=k,c=a.insertCell(-1),c.textContent=(new Number(this.modelEntity.eval_dict_label_to_count[k])).toLocaleString();this.filledModelUI=!0}document.getElementById("trainStateTd").textContent=this.util.formatJobState(this.modelEntity.cancel_requested,
this.modelEntity.train_job_state);document.getElementById("numStepsCompletedTd").textContent=(new Number(this.modelEntity.trained_steps)).toLocaleString();0<this.modelEntity.train_job_elapsed_seconds?this.trainTimeTd.textContent=this.util.formatElapsedSeconds(this.modelEntity.train_job_elapsed_seconds):this.estimateTrainTime();document.getElementById("evalStateTd").textContent=this.util.formatJobState(this.modelEntity.cancel_requested,this.modelEntity.eval_job_state);this.modelLoader.style.visibility=
"hidden"};fmltc.MonitorTraining.prototype.estimateTrainTime=function(){0==this.modelEntity.train_job_elapsed_seconds?("train_job_start_time"in this.modelEntity&&(this.trainTimeTd.textContent=this.util.formatElapsedSeconds(this.util.calculateSecondsSince(this.modelEntity.train_job_start_time))),this.trainTimeIntervalId||(this.trainTimeIntervalId=setInterval(this.estimateTrainTime.bind(this),500))):this.trainTimeIntervalId&&(clearInterval(this.trainTimeIntervalId),this.trainTimeIntervalId=0)};
fmltc.MonitorTraining.prototype.addCharts=function(a,b){if(!this.chartsLoaded)return console.log("Will retry addCharts in 1 second."),setTimeout(this.addCharts.bind(this,a,b),1E3),[];for(var c in b)a.sortedTags.includes(c)||a.sortedTags.push(c);a.sortedTags.sort(this.util.compareCaseInsensitive.bind(this.util));for(b=0;b<a.sortedTags.length;b++)if(c=a.sortedTags[b],!(c in a.mapTagToDiv)){var d=document.createElement("div");d.style.width="800px";d.style.height="500px";a.parentDiv.appendChild(d);a.mapTagToDiv[c]=
d;a.mapTagToDataTable[c]=new google.visualization.DataTable;a.mapTagToDataTable[c].addColumn("number","Step");a.mapTagToDataTable[c].addColumn("number","")}};fmltc.MonitorTraining.prototype.addScalarValue=function(a,b,c,d){b in a.mapTagToDataTable?(a.mapTagToDataTable[b].addRow([c,d]),a.mapTagToDataTable[b].sort([{column:0}]),this.drawChart(a,b)):(console.log("Will retry addScalarValue for tag "+b+" in 1 second."),setTimeout(this.addScalarValue.bind(this,a,b,c,d),1E3))};
fmltc.MonitorTraining.prototype.drawChart=function(a,b){"scalarsTabDiv"==this.util.getCurrentTabDivId()&&(b in a.mapTagToLineChart||(a.mapTagToLineChart[b]=new google.visualization.LineChart(a.mapTagToDiv[b])),a.mapTagToLineChart[b].draw(a.mapTagToDataTable[b],{width:800,height:500,hAxis:{minValue:0,maxValue:this.modelEntity.num_training_steps,title:"Step"},vAxis:{title:" "},legend:"none",lineWidth:4,pointSize:6,interpolateNulls:!0,title:b,titleTextStyle:{fontName:"Roboto",fontSize:24,bold:!0}}),
a.sortedTags[0]==b&&(a.scalarsHeading.style.display="block"))};
fmltc.MonitorTraining.prototype.addImages=function(a,b){for(var c=Math.ceil(Object.keys(a.mapTagToSteps).length/10);a.pageDivs.length<c;){i=a.pageDivs.length;var d=document.createElement("div");d.style.display=i==a.currentPageIndex?"block":"none";a.pageDivs.push(d);a.parentDiv.appendChild(d)}this.updatePageControls(a);for(var e in b)a.sortedTags.includes(e)||a.sortedTags.push(e);a.sortedTags.sort(this.compareImageTags.bind(this));for(c=0;c<a.sortedTags.length;c++){d=a.sortedTags[c];if(d in a.mapTagToDiv){e=
a.mapTagToDiv[d];var f=e.getElementsByTagName("INPUT")[0]}else{f=a.pageDivs[Math.floor(c/10)];0<f.childElementCount&&(f.appendChild(document.createElement("br")),f.appendChild(document.createElement("hr")),f.appendChild(document.createElement("br")));e=document.createElement("div");e.style.height="420px";f.appendChild(e);a.mapTagToDiv[d]=e;f=document.createElement("div");f.textContent=d;e.appendChild(f);f=document.createElement("input");f.setAttribute("type","range");f.min=0;e.appendChild(f);var g=
document.createElement("div");e.appendChild(g);a.mapTagToStepLabelDiv[d]=g;f.onchange=this.stepRangeInput_onchange.bind(this,a,d)}d in a.mapTagToImgs?g=a.mapTagToImgs[d]:(g={},a.mapTagToImgs[d]=g);if(d in b)for(var k=b[d],h=0;h<k.length;h++){var m=k[h];if(!(m in g)){var l=document.createElement("img");l.src="//:0";l.style.display="none";e.appendChild(l);g[m]=l}}f.max=a.mapTagToSteps[d].length-1}};
fmltc.MonitorTraining.prototype.compareImageTags=function(a,b){if(a==b)return 0;var c=/([^/]*)\/([0-9]+)\/([0-9]+)/,d=a.match(c);c=b.match(c);if(d&&c&&d.length==c.length){for(a=1;a<d.length;a++){b=d[a];var e=c[a];b=this.util.isNumeric(d[a])&&this.util.isNumeric(c[a])?this.util.compare(parseFloat(b),parseFloat(e)):this.util.compareCaseInsensitive(b,e);if(0!=b)return b}return 0}return this.util.compare(a,b)};
fmltc.MonitorTraining.prototype.stepRangeInput_onchange=function(a,b){var c=a.mapTagToDiv[b],d=c.getElementsByTagName("INPUT")[0],e=a.mapTagToSteps[b];d=d.value;a.mapTagToStepLabelDiv[b].textContent="Step: "+(new Number(e[d])).toLocaleString();a=a.mapTagToImgs[b];b=!1;for(var f=0;f<e.length;f++){var g=a[e[f]];f==d&&"//:0"!=g.src?(g.style.display="block",b=!0):g.style.display="none"}b&&(c.style.height="")};
fmltc.MonitorTraining.prototype.addImageValue=function(a,b,c,d,e){b in a.mapTagToImgs?setTimeout(this.retrieveImage.bind(this,a,b,c,d,0),e):(console.log("Will retry addImageValue for tag "+b+" in 1 second."),setTimeout(this.addImageValue.bind(this,a,b,c,d,e),1E3))};fmltc.MonitorTraining.prototype.retrieveImage=function(a,b,c,d,e){var f=new XMLHttpRequest;f.open("GET",d.image_url,!0);f.responseType="blob";f.onreadystatechange=this.xhr_retrieveImage_onreadystatechange.bind(this,f,a,b,c,d,e);f.send(null)};
fmltc.MonitorTraining.prototype.xhr_retrieveImage_onreadystatechange=function(a,b,c,d,e,f){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(f=b.mapTagToImgs[c][d],f.src=window.URL.createObjectURL(a.response),f.setAttribute("width",e.width/3),f.setAttribute("height",e.height/3),e=b.mapTagToSteps[c],d==e[e.length-1]&&(d=b.mapTagToDiv[c].getElementsByTagName("INPUT")[0],d.value=d.max,this.stepRangeInput_onchange(b,c))):(f++,5>f?(a=Math.pow(2,f),console.log("Will retry "+e.image_url+" in "+
a+" seconds."),setTimeout(this.retrieveImage.bind(this,b,c,d,e,f),1E3*a)):console.log("Unable to retrieve an image with url "+e.image_url)))};fmltc.MonitorTraining.prototype.firstPageButton_onclick=function(){0<this.evalImages.currentPageIndex&&(this.evalImages.currentPageIndex=0,this.currentPageIndexChanged())};fmltc.MonitorTraining.prototype.previousPageButton_onclick=function(){0<this.evalImages.currentPageIndex&&(this.evalImages.currentPageIndex--,this.currentPageIndexChanged())};
fmltc.MonitorTraining.prototype.nextPageButton_onclick=function(){this.evalImages.currentPageIndex<this.evalImages.pageDivs.length-1&&(this.evalImages.currentPageIndex++,this.currentPageIndexChanged())};fmltc.MonitorTraining.prototype.lastPageButton_onclick=function(){this.evalImages.currentPageIndex<this.evalImages.pageDivs.length-1&&(this.evalImages.currentPageIndex=this.evalImages.pageDivs.length-1,this.currentPageIndexChanged())};
fmltc.MonitorTraining.prototype.updatePageControls=function(a){0==a.pageDivs.length?(this.firstPageButton.disabled=!0,this.previousPageButton.disabled=!0,this.nextPageButton.disabled=!0,this.lastPageButton.disabled=!0):(this.firstPageButton.disabled=0==a.currentPageIndex,this.previousPageButton.disabled=0==a.currentPageIndex,this.nextPageButton.disabled=a.currentPageIndex==a.pageDivs.length-1,this.lastPageButton.disabled=a.currentPageIndex==a.pageDivs.length-1,this.currentPageSpan.textContent="Page "+
(new Number(a.currentPageIndex+1)).toLocaleString()+" of "+(new Number(a.pageDivs.length)).toLocaleString())};
fmltc.MonitorTraining.prototype.currentPageIndexChanged=function(){for(var a=this.evalImages,b=0;b<a.pageDivs.length;b++)a.pageDivs[b].style.display=b==a.currentPageIndex?"block":"none";this.updatePageControls(a);b=[];for(var c=0;c<a.sortedTags.length;c++){var d=a.sortedTags[c];if(d in a.mapTagToStepsNotRequestedYet&&this.util.isDisplayed(a.mapTagToDiv[d],a.parentDiv)){for(var e=a.mapTagToStepsNotRequestedYet[d],f=0;f<e.length;f++){var g={tag:d};g.step=e[f];b.push(g)}e.length=0}}this.retrieveSummaryItemsInParallel(a,
b,2)};fmltc.MonitorTraining.prototype.tab_onresize=function(a){if("imagesTabDiv"==a.id){var b=window.getComputedStyle(a,null);b=parseInt(b.getPropertyValue("height"));for(var c=0;c<a.children.length;c++){var d=a.children[c];d!=this.evalImagesDiv&&(b-=d.offsetHeight)}this.evalImagesDiv.style.height=b+"px"}};
fmltc.MonitorTraining.prototype.tab_onclick=function(a){if("scalarsTabDiv"==a){a=[this.trainingScalars,this.evalScalars];for(var b=0;b<a.length;b++){var c=a[b],d;for(d in c.mapTagToDiv)d in c.mapTagToLineChart||this.drawChart(c,d)}}};fmltc.StartTrainingDialog=function(a,b,c,d,e){this.util=a;this.datasetUuids=d;this.onTrainingStarted=e;this.dialog=document.getElementById("startTrainingDialog");this.dismissButton=document.getElementById("stDismissButton");this.maxRunningMinutesInput=document.getElementById("stMaxRunningMinutesInput");this.totalTrainingMinutesSpan=document.getElementById("stTotalTrainingMinutesSpan");this.remainingTrainingMinutesSpan=document.getElementById("stRemainingTrainingMinutesSpan");this.startingModelSelect=
document.getElementById("stStartingModelSelect");this.numTrainingStepsInput=document.getElementById("stNumTrainingStepsInput");this.descriptionInput=document.getElementById("stDescriptionInput");this.startButton=document.getElementById("stStartButton");this.inProgressDiv=document.getElementById("stInProgressDiv");this.successDiv=document.getElementById("stSuccessDiv");this.failedDiv=document.getElementById("stFailedDiv");this.startTrainingInProgress=!1;this.maxRunningMinutesInput.min=Math.min(20,
c);this.maxRunningMinutesInput.max=c;this.maxRunningMinutesInput.value=Math.min(60,c);if(0==this.startingModelSelect.options.length)for(a=this.util.startingModels,d=0;d<a.length;d++)e=document.createElement("option"),e.text=a[d],this.startingModelSelect.add(e);this.numTrainingStepsInput.min=100;this.numTrainingStepsInput.max=4E3;this.numTrainingStepsInput.value=2E3;this.descriptionInput.value="";this.updateStartButton();this.totalTrainingMinutesSpan.textContent=String(b);this.remainingTrainingMinutesSpan.textContent=
String(c);this.inProgressDiv.style.display="none";this.successDiv.style.display="none";this.failedDiv.style.display="none";this.dismissButton.onclick=this.dismissButton_onclick.bind(this);this.descriptionInput.oninput=this.descriptionInput_oninput.bind(this);this.startButton.onclick=this.startButton_onclick.bind(this);this.dialog.style.display="block"};
fmltc.StartTrainingDialog.prototype.dismissButton_onclick=function(){this.dismissButton.onclick=null;this.descriptionInput.oninput=null;this.startButton.onclick=null;this.dialog.style.display="none"};fmltc.StartTrainingDialog.prototype.descriptionInput_oninput=function(){this.updateStartButton()};fmltc.StartTrainingDialog.prototype.updateStartButton=function(){this.startButton.disabled=this.startTrainingInProgress||0==this.descriptionInput.value.length};
fmltc.StartTrainingDialog.prototype.startButton_onclick=function(){this.util.setWaitCursor();this.inProgressDiv.style.display="block";this.startTrainingInProgress=!0;this.updateStartButton();var a=JSON.stringify(this.datasetUuids),b=encodeURIComponent(this.startingModelSelect.options[this.startingModelSelect.selectedIndex].value),c=new XMLHttpRequest;a="description="+encodeURIComponent(this.descriptionInput.value)+"&dataset_uuids="+encodeURIComponent(a)+"&starting_model="+encodeURIComponent(b)+"&max_running_minutes="+
this.maxRunningMinutesInput.value+"&num_training_steps="+this.numTrainingStepsInput.value+"&create_time_ms="+Date.now();c.open("POST","/startTrainingModel",!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.onreadystatechange=this.xhr_startTrainingModel_onreadystatechange.bind(this,c,a);c.send(a)};
fmltc.StartTrainingDialog.prototype.xhr_startTrainingModel_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(b=JSON.parse(a.responseText),a=Math.floor(b.remaining_training_minutes),b=b.model_entity,this.startTrainingInProgress=!1,this.updateStartButton(),this.inProgressDiv.style.display="none",this.successDiv.style.display="block",this.util.clearWaitCursor(),this.onTrainingStarted(a,b),setTimeout(this.dismissButton_onclick.bind(this),1E3)):(console.log("Failure! /startTrainingModel?"+
b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),this.startTrainingInProgress=!1,this.updateStartButton(),this.inProgressDiv.style.display="none",this.failedDiv.style.display="block"))};fmltc.TrainMoreDialog=function(a,b,c,d,e,f){this.util=a;this.datasetEntities=e;this.modelEntity=d;this.onTrainingStarted=f;this.dialog=document.getElementById("trainMoreDialog");this.dismissButton=document.getElementById("tmDismissButton");this.maxRunningMinutesInput=document.getElementById("tmMaxRunningMinutesInput");this.totalTrainingMinutesSpan=document.getElementById("tmTotalTrainingMinutesSpan");this.remainingTrainingMinutesSpan=document.getElementById("tmRemainingTrainingMinutesSpan");this.numTrainingStepsInput=
document.getElementById("tmNumTrainingStepsInput");this.datasetContainerDiv=document.getElementById("tmDatasetContainerDiv");this.descriptionInput=document.getElementById("tmDescriptionInput");this.startButton=document.getElementById("tmStartButton");this.inProgressDiv=document.getElementById("tmInProgressDiv");this.successDiv=document.getElementById("tmSuccessDiv");this.failedDiv=document.getElementById("tmFailedDiv");this.checkboxes=[];this.startTrainingInProgress=!1;this.maxRunningMinutesInput.min=
Math.min(20,c);this.maxRunningMinutesInput.max=c;this.maxRunningMinutesInput.value=Math.min(60,c);this.numTrainingStepsInput.min=100;this.numTrainingStepsInput.max=4E3;this.numTrainingStepsInput.value=2E3;for(a=0;a<this.datasetEntities.length;a++)d=document.createElement("input"),this.checkboxes[a]=d,d.setAttribute("type","checkbox"),d.id=this.datasetEntities[a].dataset_uuid,this.isDatasetInModel(this.datasetEntities[a])&&(d.checked=!0,d.disabled=!0),this.datasetContainerDiv.appendChild(d),e=document.createElement("label"),
e.textContent=this.datasetEntities[a].description,e.setAttribute("for",d.id),this.datasetContainerDiv.appendChild(e),this.datasetContainerDiv.appendChild(document.createElement("br"));this.descriptionInput.value="";this.updateStartButton();this.totalTrainingMinutesSpan.textContent=String(b);this.remainingTrainingMinutesSpan.textContent=String(c);this.inProgressDiv.style.display="none";this.successDiv.style.display="none";this.failedDiv.style.display="none";this.dismissButton.onclick=this.dismissButton_onclick.bind(this);
this.descriptionInput.oninput=this.descriptionInput_oninput.bind(this);this.startButton.onclick=this.startButton_onclick.bind(this);this.dialog.style.display="block"};fmltc.TrainMoreDialog.prototype.isDatasetInModel=function(a){for(var b=0;b<this.modelEntity.dataset_uuids.length;b++)if(this.modelEntity.dataset_uuids[b]==a.dataset_uuid)return!0;return!1};
fmltc.TrainMoreDialog.prototype.dismissButton_onclick=function(){this.dismissButton.onclick=null;this.descriptionInput.oninput=null;this.startButton.onclick=null;this.dialog.style.display="none"};fmltc.TrainMoreDialog.prototype.descriptionInput_oninput=function(){this.updateStartButton()};fmltc.TrainMoreDialog.prototype.updateStartButton=function(){this.startButton.disabled=this.startTrainingInProgress||0==this.descriptionInput.value.length};
fmltc.TrainMoreDialog.prototype.startButton_onclick=function(){this.util.setWaitCursor();this.inProgressDiv.style.display="block";this.startTrainingInProgress=!0;this.updateStartButton();for(var a=[],b=0;b<this.datasetEntities.length;b++)!this.checkboxes[b].disabled&&this.checkboxes[b].checked&&a.push(this.datasetEntities[b].dataset_uuid);b=JSON.stringify(a);var c=this.modelEntity.model_uuid;a=new XMLHttpRequest;b="description="+encodeURIComponent(this.descriptionInput.value)+"&dataset_uuids="+encodeURIComponent(b)+
"&starting_model="+encodeURIComponent(c)+"&max_running_minutes="+this.maxRunningMinutesInput.value+"&num_training_steps="+this.numTrainingStepsInput.value+"&create_time_ms="+Date.now();a.open("POST","/startTrainingModel",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=this.xhr_startTrainingModel_onreadystatechange.bind(this,a,b);a.send(b)};
fmltc.TrainMoreDialog.prototype.xhr_startTrainingModel_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(b=JSON.parse(a.responseText),a=Math.floor(b.remaining_training_minutes),b=b.model_entity,this.startTrainingInProgress=!1,this.updateStartButton(),this.inProgressDiv.style.display="none",this.successDiv.style.display="block",this.util.clearWaitCursor(),this.onTrainingStarted(a,b),setTimeout(this.dismissButton_onclick.bind(this),1E3)):(console.log("Failure! /startTrainingModel?"+
b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),this.startTrainingInProgress=!1,this.updateStartButton(),this.inProgressDiv.style.display="none",this.failedDiv.style.display="block"))};fmltc.UploadVideoFileDialog=function(a,b){this.util=a;this.onVideoUploaded=b;this.dialog=document.getElementById("uploadVideoFileDialog");this.dismissButton=document.getElementById("uvfDismissButton");this.videoFileInput=document.getElementById("uvfVideoFileInput");this.descriptionInput=document.getElementById("uvfDescriptionInput");this.uploadButton=document.getElementById("uvfUploadButton");this.uploadingH3=document.getElementById("uvfUploadingH3");this.uploadingProgress=document.getElementById("uvfUploadingProgress");
this.uploadingFinishedDiv=document.getElementById("uvfUploadingFinishedDiv");this.uploadingFailedDiv=document.getElementById("uvfUploadingFailedDiv");this.videoFile=null;this.videoUuid="";this.createTimeMs=0;this.uploadFailed=this.uploadFinished=!1;this.descriptionInput.value="";this.dismissButton.onclick=this.dismissButton_onclick.bind(this);this.videoFileInput.onchange=this.videoFileInput_onchange.bind(this);this.descriptionInput.oninput=this.descriptionInput_oninput.bind(this);this.uploadButton.onclick=
this.uploadButton_onclick.bind(this);this.setState(fmltc.UploadVideoFileDialog.STATE_ZERO)};fmltc.UploadVideoFileDialog.STATE_ZERO=0;fmltc.UploadVideoFileDialog.STATE_FILE_CHOSEN=1;fmltc.UploadVideoFileDialog.STATE_UPLOADING=2;fmltc.UploadVideoFileDialog.STATE_UPLOADING_FAILED=3;fmltc.UploadVideoFileDialog.STATE_UPLOADING_FINISHED=4;
fmltc.UploadVideoFileDialog.prototype.setState=function(a){this.state=a;switch(this.state){case fmltc.UploadVideoFileDialog.STATE_ZERO:this.videoFileInput.value="";this.videoFileInput.disabled=!1;this.dismissButton.disabled=!1;this.updateUploadButton();this.uploadingH3.style.visibility="hidden";this.uploadingProgress.style.visibility="hidden";this.uploadingFinishedDiv.style.display="none";this.uploadingFailedDiv.style.display="none";this.dialog.style.display="block";break;case fmltc.UploadVideoFileDialog.STATE_FILE_CHOSEN:this.updateUploadButton();
break;case fmltc.UploadVideoFileDialog.STATE_UPLOADING:this.dismissButton.disabled=!0;this.updateUploadButton();this.uploadingH3.style.visibility="visible";this.uploadingProgress.style.visibility="visible";this.videoFileInput.disabled=!0;break;case fmltc.UploadVideoFileDialog.STATE_UPLOADING_FAILED:this.dismissButton.disabled=!1;this.uploadingFailedDiv.style.display="block";break;case fmltc.UploadVideoFileDialog.STATE_UPLOADING_FINISHED:this.dismissButton.disabled=!1,this.uploadingFinishedDiv.style.display=
"block"}};fmltc.UploadVideoFileDialog.prototype.dismissButton_onclick=function(){this.videoFile=null;this.videoUuid="";this.videoFileInput.onchange=null;this.descriptionInput.oninput=null;this.dismissButton.onclick=null;this.uploadButton.onclick=null;this.dialog.style.display="none"};fmltc.UploadVideoFileDialog.prototype.videoFileInput_onchange=function(){0==this.videoFileInput.files.length?this.setState(fmltc.UploadVideoFileDialog.ZERO):(this.videoFile=this.videoFileInput.files[0],this.setState(fmltc.UploadVideoFileDialog.STATE_FILE_CHOSEN))};
fmltc.UploadVideoFileDialog.prototype.descriptionInput_oninput=function(){this.updateUploadButton()};fmltc.UploadVideoFileDialog.prototype.updateUploadButton=function(){this.uploadButton.disabled=this.state!=fmltc.UploadVideoFileDialog.STATE_FILE_CHOSEN||0==this.descriptionInput.value.length};
fmltc.UploadVideoFileDialog.prototype.uploadButton_onclick=function(){this.createTimeMs=Date.now();this.uploadingProgress.value=0;this.uploadingProgress.max=this.videoFile.size;this.setState(fmltc.UploadVideoFileDialog.STATE_UPLOADING);this.prepareToUploadVideo()};
fmltc.UploadVideoFileDialog.prototype.prepareToUploadVideo=function(){var a=new XMLHttpRequest,b="description="+encodeURIComponent(this.descriptionInput.value)+"&video_filename="+encodeURIComponent(this.videoFile.name)+"&file_size="+encodeURIComponent(this.videoFile.size)+"&content_type="+encodeURIComponent(this.videoFile.type)+"&create_time_ms="+this.createTimeMs;a.open("POST","/prepareToUploadVideo",!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.onreadystatechange=
this.xhr_prepareToUploadVideo_onreadystatechange.bind(this,a,b);a.send(b)};
fmltc.UploadVideoFileDialog.prototype.xhr_prepareToUploadVideo_onreadystatechange=function(a,b){4===a.readyState&&(a.onreadystatechange=null,200===a.status?(a=JSON.parse(a.responseText),this.uploadVideoFile(a.upload_url,a.video_uuid)):(console.log("Failure! /prepareToUploadVideo?"+b+" xhr.status is "+a.status+". xhr.statusText is "+a.statusText),console.log("Will retry /prepareToUploadVideo?"+b+" in 1 seconds."),setTimeout(this.prepareToUploadVideo.bind(this),1E3)))};
fmltc.UploadVideoFileDialog.prototype.uploadVideoFile=function(a,b){var c=new XMLHttpRequest;c.open("PUT",a,!0);c.setRequestHeader("Content-Type",this.videoFile.type);c.upload.onprogress=this.xhr_uploadVideoFile_onprogress.bind(this);c.onreadystatechange=this.xhr_uploadVideoFile_onreadystatechange.bind(this,c,b);c.send(this.videoFile)};fmltc.UploadVideoFileDialog.prototype.xhr_uploadVideoFile_onprogress=function(a){this.uploadingProgress.value=a.loaded};
fmltc.UploadVideoFileDialog.prototype.xhr_uploadVideoFile_onreadystatechange=function(a,b){4===a.readyState&&(a.upload.onprogress=null,a.onreadystatechange=null,200===a.status?(this.uploadingProgress.value=this.uploadingProgress.max,this.uploadFinished=!0,this.setState(fmltc.UploadVideoFileDialog.STATE_UPLOADING_FINISHED),this.onVideoUploaded(b),setTimeout(this.dismissButton_onclick.bind(this),1E3)):(console.log("Failure! uploading videoFile xhr.status is "+a.status+". xhr.statusText is "+a.statusText),
this.uploadFailed=!0,this.setState(fmltc.UploadVideoFileDialog.STATE_UPLOADING_FAILED)))};
